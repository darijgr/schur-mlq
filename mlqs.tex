\documentclass[reqno]{amsart}
\usepackage{setspace,tikz,xcolor,mathrsfs,listings,multicol}
\usepackage{amssymb}
\usepackage{rotating}
\usepackage[vcentermath]{youngtab}
\usepackage{enumerate}
\usepackage[all,cmtip]{xy}
\usetikzlibrary{arrows,matrix}
\usepackage{comment}
\usepackage{color}
\usepackage[sc]{mathpazo}
\usepackage[T1]{fontenc}
\usepackage{needspace}
\usepackage{tabls}
%\usepackage{amsmath}
%\usepackage{amsthm}
%\usepackage{subcaption}
%\usepackage{fullpage}
%\usepackage[margin=1.25in]{geometry}
%\onehalfspacing

\usepackage[colorlinks=true, pdfstartview=FitV, linkcolor=blue, citecolor=blue, urlcolor=blue]{hyperref}

% use these commands for typesetting doi and arXiv references in the bibliography
\newcommand{\doi}[1]{\href{https://doi.org/#1}{\texttt{doi:#1}}}
\newcommand{\arxiv}[1]{\href{http://arxiv.org/abs/#1}{\texttt{arXiv:#1}}}

\newcommand{\iso}{\cong}
%\newcommand{\qedbox}{\rule{2mm}{2mm}}
%\renewcommand{\qedsymbol}{\qedbox}
\newcommand{\qbinom}[3]{\genfrac{[}{]}{0pt}{}{#1}{#2}_{#3}}
\newcommand{\absval}[1]{\left\lvert #1 \right\rvert}
\newcommand{\case}[1]{\vspace{12pt}\noindent\underline{#1}:}
\newcommand{\fs}{\mathcal{S}} % flagged Schur function
\newcommand{\mbf}{\mathbf}
\newcommand{\0}{\phantom{c}}
\newcommand{\swt}[1]{\left\langle #1 \right\rangle} % Spectral weight or amplitude
\newcommand{\merge}[1]{\vee_{#1}} % merge
\newcommand{\SymGp}[1]{\mathfrak{S}_{#1}} % symmetric group
\newcommand{\std}[1]{\widetilde{#1}} % standardization

\DeclareMathOperator{\supp}{supp} % Support
\DeclareMathOperator{\inter}{int} % queuing interval
\DeclareMathOperator{\wt}{wt} % weight
\DeclareMathOperator{\pr}{pr} % promotion
\DeclareMathOperator{\id}{id} % identity
\DeclareMathOperator{\ch}{ch} % character
\DeclareMathOperator{\gr}{gr} % grading

\newcommand{\xx}{\mathbf{x}}
\newcommand{\mm}{\mathbf{m}}
\newcommand{\nn}{\mathbf{n}}
\newcommand{\qq}{\mathbf{q}}
\newcommand{\MLQ}{\mathbf{S}}

\newcommand{\mcA}{\mathcal{A}}
\newcommand{\mcF}{\mathcal{F}}
\newcommand{\mcM}{\mathcal{M}}
\newcommand{\mcW}{\mathcal{W}}
\newcommand{\mcI}{\mathcal{I}}

\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}

\newcommand{\bze}{\overline{0}}
\newcommand{\bon}{\overline{1}}
\newcommand{\btw}{\overline{2}}
\newcommand{\bth}{\overline{3}}
\newcommand{\bfo}{\overline{4}}
\newcommand{\bfive}{\overline{5}}
\newcommand{\bsix}{\overline{6}}
\newcommand{\bseven}{\overline{7}}
\newcommand{\beight}{\overline{8}}
\newcommand{\bi}{\overline\imath}
\newcommand{\bk}{\overline{k}}
\newcommand{\brr}{\overline{r}}
\newcommand{\bn}{\overline{n}}
\newcommand{\ellbar}{\overline{\ell}}

\newcommand{\fraks}{\mathfrak{s}}

\let\sumnonlimits\sum
\let\prodnonlimits\prod
\let\cupnonlimits\bigcup
\let\capnonlimits\bigcap
\renewcommand{\sum}{\sumnonlimits\limits}
\renewcommand{\prod}{\prodnonlimits\limits}
\renewcommand{\bigcup}{\cupnonlimits\limits}
\renewcommand{\bigcap}{\capnonlimits\limits}

\newenvironment{verlong}{}{}
\newenvironment{vershort}{}{}
\newenvironment{noncompile}{}{}
\excludecomment{verlong}
\includecomment{vershort}
\excludecomment{noncompile}
\newcommand{\rev}{\operatorname{rev}}
\newcommand{\conncomp}{\operatorname{conncomp}}
\newcommand{\core}{\operatorname{core}}
\newcommand{\col}{\operatorname{col}}
\newcommand{\colw}{\operatorname{colw}}
\newcommand{\word}{\operatorname{word}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\powset}[2][]{\ifthenelse{\equal{#2}{}}{\mathcal{P}\left(#1\right)}{\mathcal{P}_{#1}\left(#2\right)}}
% $\powset[k]{S}$ stands for the set of all $k$-element subsets of
% $S$. The argument $k$ is optional, and if not provided, the result
% is the whole powerset of $S$.
\newcommand{\set}[1]{\left\{ #1 \right\}}
% $\set{...}$ yields $\left\{ ... \right\}$.
\newcommand{\abs}[1]{\left| #1 \right|}
% $\abs{...}$ yields $\left| ... \right|$.
\newcommand{\tup}[1]{\left( #1 \right)}
% $\tup{...}$ yields $\left( ... \right)$.
\newcommand{\ive}[1]{\left[ #1 \right]}
% $\ive{...}$ yields $\left[ ... \right]$.
\newcommand{\verts}[1]{\operatorname{V}\left( #1 \right)}
% $\verts{...}$ yields $\operatorname{V}\left( ... \right)$.
\newcommand{\edges}[1]{\operatorname{E}\left( #1 \right)}
% $\edges{...}$ yields $\operatorname{E}\left( ... \right)$.
\newcommand{\arcs}[1]{\operatorname{A}\left( #1 \right)}
% $\arcs{...}$ yields $\operatorname{A}\left( ... \right)$.
\newcommand{\underbrack}[2]{\underbrace{#1}_{\substack{#2}}}
% $\underbrack{...1}{...2}$ yields
% $\underbrace{...1}_{\substack{...2}}$. This is useful for doing
% local rewriting transformations on mathematical expressions with
% justifications.
\newcommand{\mlnode}[1]{\node[circle, draw=black] at (#1){\phantom{c}};}

% Dark red emphasis
\definecolor{darkred}{rgb}{0.7,0,0} % darkred color
\newcommand{\defn}[1]{{\color{darkred}\emph{#1}}} % emphasis of a definition

%% For typesetting code listings                                                
\usepackage{listings}
\lstdefinelanguage{Sage}[]{Python}
{morekeywords={False,sage,True},sensitive=true}
\lstset{
  frame=single,
  showtabs=False,
  showspaces=False,
  showstringspaces=False,
  commentstyle={\ttfamily\color{dgreencolor}},
  keywordstyle={\ttfamily\color{dbluecolor}\bfseries},
  stringstyle={\ttfamily\color{dgraycolor}\bfseries},
  language=Sage,
  basicstyle={\footnotesize\ttfamily},
  aboveskip=0.75em,
  belowskip=0.75em,
  xleftmargin=.15in,
}
\definecolor{dblackcolor}{rgb}{0.0,0.0,0.0}
\definecolor{dbluecolor}{rgb}{0.01,0.02,0.7}
\definecolor{dgreencolor}{rgb}{0.2,0.4,0.0}
\definecolor{dgraycolor}{rgb}{0.30,0.3,0.30}
\newcommand{\dblue}{\color{dbluecolor}\bf}
\newcommand{\dred}{\color{dredcolor}\bf}
\newcommand{\dblack}{\color{dblackcolor}\bf}

\usepackage{xparse}

\makeatletter
% \specialmergetwolists{<coupler>}{<list1>}{<list2>}{<return macro>}
% \specialmergetwolists*{<coupler>}{<listcmd1>}{<listcmd2>}{<return macro>}
\protected\def\specialmergetwolists{%
  \begingroup
  \@ifstar{\def\cnta{1}\@specialmergetwolists}
    {\def\cnta{0}\@specialmergetwolists}%
}
\def\@specialmergetwolists#1#2#3#4{%
  \def\tempa##1##2{%
    \edef##2{%
      \ifnum\cnta=\@ne\else\expandafter\@firstoftwo\fi
      \unexpanded\expandafter{##1}%
    }%
  }%
  \tempa{#2}\tempb\tempa{#3}\tempa
  \def\cnta{0}\def#4{}%
  \foreach \x in \tempb{%
    \xdef\cnta{\the\numexpr\cnta+1}%
    \gdef\cntb{0}%
    \foreach \y in \tempa{%
      \xdef\cntb{\the\numexpr\cntb+1}%
      \ifnum\cntb=\cnta\relax
        \xdef#4{#4\ifx#4\empty\else,\fi\x#1\y}%
        \breakforeach
      \fi
    }%
  }%
  \endgroup
}
\makeatother

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\theoremstyle{definition}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{example}[thm]{Example}
\newtheorem{remark}[thm]{Remark}
\numberwithin{equation}{section}
%\numberwithin{figure}{section}
%\numberwithin{table}{section}
%\setcounter{section}{-1}

% For breaking equations across multiple pages
% \allowdisplaybreaks[1]

\usepackage[colorinlistoftodos]{todonotes}
\newcommand{\erik}[1]{\todo[size=\tiny,color=green!30]{#1 \\ \hfill --- Erik}}
\newcommand{\Erik}[1]{\todo[size=\tiny,inline,color=green!30]{#1
      \\ \hfill --- Erik}}
\newcommand{\darij}[1]{\todo[size=\tiny,color=red!30]{#1 \\ \hfill --- Darij}}
\newcommand{\Darij}[1]{\todo[size=\tiny,inline,color=red!30]{#1
      \\ \hfill --- Darij}}
\newcommand{\travis}[1]{\todo[size=\tiny,color=blue!30]{#1 \\ \hfill --- Travis}}
\newcommand{\Travis}[1]{\todo[size=\tiny,inline,color=blue!30]{#1
      \\ \hfill --- Travis}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\title[MLQs]{Multiline queues with spectral parameters}

\author[E.~Aas]{Erik Aas}
\address[E. Aas]{Department of Mathematics, Pennsylvania State University, McAllister Building, State College, PA 116802, USA}
\email{eaas@kth.se}

\author[D.~Grinberg]{Darij Grinberg}
\address[D. Grinberg]{School of Mathematics, University of Minnesota, 206 Church St. SE, Minneapolis, MN 55455}
\email{darijgrinberg@gmail.com}
\urladdr{http://www.cip.ifi.lmu.de/~grinberg/}

\author[T.~Scrimshaw]{Travis Scrimshaw}
\address[T. Scrimshaw]{School of Mathematics and Physics, The University of Queensland, St. Lucia, QLD 4072, Australia}
\email{tcscrims@gmail.com}
\urladdr{https://sites.google.com/view/tscrim/home}

\date{\today}

\keywords{multiline queue, TASEP, R-matrix, symmetric function}
\subjclass[2010]{
60C05,  % Combinatorial probability
05A19,  % Combinatorial identities, bijective combinatorics
16T25,  % Yang--Baxter equations
05E05}  % Symmetric functions

\thanks{TS was partially supported by the Australian Research Council DP170102648 and the National Science Foundation RTG grant DMS-1148634.}

\begin{abstract}
Using the description of multiline queues as functions on words, we introduce the notion of a spectral weight of a word by defining a new weighting on multiline queues.
We show that the spectral weight of a word is invariant under a natural action of the symmetric group, giving a proof of the commutativity conjecture of Arita, Ayyer, Mallick, and Prolhac.
We give a determinant formula for the spectral weight of a word, which gives a proof of a conjecture of the first author and Linusson.
\end{abstract}

\maketitle

%=====================================================================
\section{Introduction}
\label{sec:introduction}

One of the fundamental models of particles moving in a 1-dimensional lattice is the asymmetric simple exclusion process (ASEP), and it has received broad attention in many different variations.
The earliest known publication of the ASEP was done to model the dynamics of ribosomes along RNA~\cite{MGP68}.
For statistical mechanics, it is a model for gas particles in a lattice with an induced current, where the exclusion mimics the short-range interactions among the particles.
Despite admitting very simple descriptions of the particle dynamics, the ASEP has very rich macroscopic behaviors, such as
\begin{itemize}
\item boundary-induced phase transitions~\cite{Krug91},
\item spontaneous symmetry breaking with possibly multiple broken symmetry phases~\cite{AHR98,AHR99,CEM01,EFGM95,EPSZ05,GLEMSS95,PK07},
\item describing the formations of shocks~\cite{DJLS93,Ferrari92,FF94,FF94II,Liggett76}, and
\item phase separation and condensation~\cite{EKKM98,JNHWW09,KLMST02,RSS00}.
\end{itemize}
We also refer the reader to~\cite{PEM09,Schutz01,SZ95,TJHJ16} and references therein.

The term exclusion process was coined by Spitzer~\cite{Spitzer70}, where he was focused on an application with Brownian motion with hard-core interactions.
Moreover, it was~\cite{Spitzer70} that initiated the investigation of exclusion processes using probability theory.
However, the applications of the ASEP (and its variations) has since spread to other areas, such as
\begin{itemize}
\item transportation processes in capillary vessels~\cite{Levitt73} or proteins within the cells along actin filaments~\cite{KNL05},
\item anistropic conductors known as solid electrolytes~\cite{CL99},
\item discrete models of traffic flow~\cite{Schad01},
\item partition growth processes~\cite{Lam15},
\item random matrix theory~\cite{Johansson00,TW09}, and
\item moments of Askey--Wilson polynomials~\cite{CW11}.
\end{itemize}

If we prohibit the particles from moving backwards, we obtain the totally asymmetric exclusion process (TASEP), a non-equilibrium stochastic process that has its own vast literature.
For example, we refer the reader to~\cite{AasLin17,AAMP,BE07,BP14,DEHP93,KMO15,KMO16,Liggett99} and references therein.
In this paper, we consider the TASEP on a ring with $n$ sites and $\ell$ species of particles.
Thus, we will consider the states to be words $u$ in the alphabet $\{1, \dotsc, \ell\}$ of length $n$, where we take the indices to be $\ZZ / n \ZZ$.
We will also consider our process to be discrete in time, where our transition map interchanges a pair $u_i u_{i+1}$ with $u_i > u_{i+1}$ to $u_{i+1} u_i$ and is done at a uniform rate.

The steady state of the TASEP on a ring is known in terms of another process using ordinary multiline queues (MLQs) and applying the Ferrari--Martin (FM) algorithm~\cite{FM06,FM07}.
This is a generalization of 2-line queues used by Angel~\cite{Angel06} and the work of Ferrari, Fontes, and Kohayakawa~\cite{FFK94}.
In~\cite{KMO15,KMO16}, the FM algorithm was reformulated in terms of the combinatorial $R$-matrix~\cite{NY97,Shimozono02} and using type $A_{n-1}^{(1)}$ Kirillov--Reshetikhin crystals~\cite{KKMMNN92}.
This interpretation gives a connection with five-vertex models, corner transfer matrices~\cite{Baxter89}, 3D integrable lattice models, and the tetrahedron equation~\cite{Zam80}, yielding a matrix product formula for the steady state distribution different than~\cite{CdGW15,EFM09,PEM09}.

In this paper, we introduce a new weighting of MLQs, which is the weight of the MLQ considered as a tensor product of Kirillov--Reshetikhin crystals.
We also interpret MLQs as functions on words of a fixed length $n$ following~\cite{AAMP}, where it was referred to as the generalized FM algorithm.
This allows us to define the spectral weight or amplitude of a word $u$ to be the sum over all the weight of all ordinary MLQs $\qq$ such that $u = \qq(1^n)$.
Furthermore, we introduce the notion of a $\sigma$-twisted MLQ, where $\sigma$ is a permutation, although this is implicitly considered in~\cite{AAMP}.
Our main result (Theorem~\ref{thm:permutation}) is that for a fixed permutation $\sigma$, the sum of the weights of all $\sigma$-twisted MLQs $\qq_{\sigma}$ such that $u = \qq_{\sigma}(1^n)$ equals the spectral weight of $u$.
To this end, we construct an action of the symmetric group on MLQs that corresponds, under the usual FM algorithm, to the natural action by letters on words.
We show that does not change the MLQ as a function on words.
This action has previously appeared in a number of different guises, such as in Danilov and Koshevoy~\cite{DanilovKoshevoy} (see also~\cite[Ch.~4]{Gorodentsev2}), van Leeuwen~\cite[Lemma~2.3]{vanLeeuwen-dc}, and Lothaire~\cite[Ch.~5, (5.6.3)]{Loth}.
In the context of Kirillov--Reshetikhin crystals, it can be described as applying a combinatorial $R$-matrix to an MLQ, where the weight remaining invariant is a condition of being a crystal isomorphism.

As a consequence of this action and specializing our weight parameters to $1$, we obtain a proof of the commutativity conjecture of~\cite{AAMP}.
However, we note that the interlacing property of~\cite{AAMP} does not generalize to our weighting of MLQs.
Furthermore, we give a determinant expression for the spectral weight of decreasing words by using the Lindstr\"om--Gessel--Viennot Lemma~\cite{GV85,Lindstrom73}.
By combining these results, we obtain a proof of~\cite[Conj.~3.10]{AasLin17}, which in turn proves a number of other conjectures in~\cite{AasLin17}.

We note that our weighting scheme can be extended to multiline process used to determine the steady state distribution of the totally asymmetric zero range process (TARZP) on a ring, where multiple particles can occupy the same site.
This comes from the fact that the TARZP steady state distribution can also be computed using a tensor product of Kirillov--Reshetikhin crystals (under rank-level duality) using combinatorial $R$-matrices with analogous connections to corner transfer matrices and the tetrahedron equation~\cite{KMO16TARZP,KMO16TARZPII}.
Thus, we expect that a similar description of $\sigma$-twisted multiline process can be defined such that the weighting is invariant under the action of the combinatorial $R$-matrix.
Yet it seems unlikely that our weighting is related to the steady state distribution for the inhomogeneous TASEP~\cite{AM13,AL14} or TARZP~\cite{KMO16II}.

This paper is organized as follows.
In Section~\ref{sec:background}, we give the necessary background and definitions of MLQs and spectral weight.
In Section~\ref{sec:result}, we give our main results.
In Section~\ref{sec:JT_formula}, we show a Jacobi-Trudi like formula for special words $u$, which we use to prove some of the conjectures in~\cite{AasLin17}.
In Section~\ref{sec:tasep}, we describe the connection between MLQs and the TASEP.
In Section~\ref{sec:thm_proof}, we give a proof of our main theorem (Theorem~\ref{thm:permutation}).
In Section~\ref{sec:remarks}, we give some additional remarks about our results.


\subsection{Acknowledgements}

We thank Atsuo Kuniba for explaining the results in his papers~\cite{KMO15,KMO16II,KMO16,KMO16TARZP,KMO16TARZPII}.
We thank Olya Mandelshtam for useful discussions on the inhomogeneous TASEP.
We thank Jae-Hoon Kwon for pointing out that the $\SymGp{n}$-action on MLQs comes from an $(\mathfrak{sl}_m \oplus \mathfrak{sl}_n)$-action.
This work benefited from computations using \textsc{SageMath}~\cite{sage,combinat}.









%=====================================================================
\section{Background and definitions}
\label{sec:background}

Fix a positive integer $n$.
For a nonnegative integer $k$, let $\ive{k}$ denote the set $\set{1, 2, \ldots, k}$, and so $[0] = \emptyset$.
Let $\SymGp{k}$ denote the symmetric group on $\ive{k}$, and let $s_i \in \SymGp{k}$ be the simple transposition of $i$ and $i+1$.
Let $w_0 \in \SymGp{k}$ be the longest element: the permutation $k (k-1) \dotsm 321$ (written in one line notation) that reverses the order of all elements.

We shall refer to the elements $1, 2, \ldots, n \in \ZZ / n \ZZ$ as \defn{sites}.
We visualize them as points on a line that ``wraps around'' cyclically; thus, for example, the sites weakly to the right of a site $i$ are $i, i+1, \ldots, n-1, n, 1, 2, 3, \ldots$ (in this order).

%%%%%%%%%%
\subsection{Words and queues}

Let $\mcW_n$ be the set of words $u = u_1 \dotsm u_n$ in the ordered alphabet $\mcA := \{1 < 2 < 3 < \cdots \}$.
We consider the indices of letters in a word to be taken modulo $n$ (that is, $u_{k+n} = u_k$ for all $k$).
Let $\xx := \{x_1, x_2, x_3, \ldots\}$ be commuting indeterminates.

The \defn{type} of a word $u$ is the vector $\mm = (m_1, m_2, \ldots)$, where $m_i$ is the number of occurrences of $i$ in $u$.
We sometimes refer to $u_i = t$ as a \defn{particle at $i$ of class $t$}.
Let $\ell = \max\{i \mid m_i \neq 0 \}$, which we say is the number of \defn{classes} in $u$ or $\mm$.
A word $u$ or type $\mm$ with $\ell$ classes is \defn{packed} if $m_i \neq 0$ for all $1 \leq i \leq \ell$.
A word $w$ of type $\mm$ is \defn{standard} if $m_i \leq 1$ for all $i$.

We \defn{merge} two adjacent classes $i,i+1$ in a word $u$ to obtain a new word by replacing all occurrences of $j$ by $j-1$ in $u$ for each $j = i+1, i+2, \ldots$ in that order.
We denote the merging of $i$ and $i+1$ in $u$ by $\merge{i} u$.
Note that $\merge{i} u$ is packed whenever $u$ is packed.
For $T = \set{t_1 < \cdots < t_k} \subseteq \ive{\ell-1}$, we set $\bigvee_T u := \merge{t_1} \cdots \merge{t_k} u$.
Similarly, the merging of $i,i+1$ in a type $\mm = (m_1, m_2, \ldots)$ is $\merge{i}(\mm) = (m_1, \dotsc, m_{i-1}, m_i + m_{i+1}, m_{i+2}, \ldots)$.
These operations interact as one would hope:
If the type of a word $u$ is $\mm$, then the type of $\merge{i} u$ is $\merge{i}(\mm)$.

Fix a word $u \in \mcW_n$, and let $\mm = (m_1, m_2, \ldots)$ be the type of $u$.
For each $i \geq 0$, set
\begin{equation}
\label{eq:type_partial_sums}
p_i(\mm) := m_1 + m_2 + \cdots + m_i.
\end{equation}
When $\mm$ is clear, we simply write $p_i$ for this.
(Thus, $p_0 = 0$ and $p_i = n$ for sufficiently large $i$.)

We define an \defn{$r$-queue} $q$ to be any subset of $\ive{n}$ of size $r$. When $r$ is clear, we will simply call $q$ a \defn{queue}.
The \defn{weight} of a queue $q$ is $\wt(q) := \prod_{i \in q} x_i$.
We equate $q$ with a function from $\mcW_n$ to itself defined as follows.
For any $u \in \mcW_n$, the following algorithm computes $v = q(u)$.
In the beginning, no letter of $v \in \mcW_n$ is set.
Choose a permutation $\tup{i_1, i_2, \ldots, i_n}$ of $\tup{1, 2, \ldots, n}$
such that $u_{i_1} \leq u_{i_2} \leq \cdots \leq u_{i_n}$.

\begin{description}
\item[Phase I]
  For $i = i_n, i_{n-1}, \ldots, i_{\abs{q}+1}$, do the following.
    Find the first site $j$ weakly to the left (cyclically) of $i$ such that $j \notin q$ and $v_j$ is not set.
    Then set $v_j = u_i + 1$.

\item[Phase II]
  For $i = i_1, i_2, \ldots, i_{\abs{q}}$, do the following.
    Find the first site $j$ weakly to the right (cyclically) of $i$ such that $j \in q$ and $v_j$ is not set.
    Then set $v_j = u_i$.
\end{description}

\begin{remark}
\label{rmk:order-agnostic}
Consider the above algorithm.
Notice that Phase~I sets $v_j$ for all $j \notin q$ (because it contains
$n - \abs{q}$ steps, and sets one such $v_j$ per step),
whereas Phase~II sets $v_j$ for all $j \in q$ (for similar reasons).
Hence, at the end of the algorithm, all letters of $v$ are set, and we never
run out of $j$'s in either phase.

Since Phase~I only deals with $j \notin q$, and Phase~II only with $j\in q$,
the two phases can be arbitrarily interleaved
(\textit{i.e.}, we can perform the steps of the algorithm in any order as long as
the steps of Phase~I (resp.\ Phase~II) are processed in the order $i = i_n, i_{n-1}, \ldots, i_{\abs{q}+1}$
(resp.\ $i = i_1, i_2, \ldots, i_{\abs{q}}$).
\end{remark}

\begin{lemma}
\label{lemma:order_indep}
The resulting word $v = q(u)$ does not depend on the choice of permutation $(i_1, i_2, \dotsc, i_n)$.
\end{lemma}

\begin{proof}
Consider some $k$ such that $u_{i_k} = u_{i_{k+1}}$.
If we switch the two (equal) adjacent entries $i_k$ and $i_{k+1}$ of the
permutation $\tup{i_1, i_2, \ldots, i_n}$,
then the resulting word $v$ is unchanged.
Indeed, if we set $h = u_{i_k} = u_{i_{k+1}}$, then:
\begin{itemize}
 \item If $k < \abs{q}$, then this switch interchanges two consecutive
       steps in Phase~II, causing the corresponding letters $v_j$ to
       get set in a possibly different order; but this does not change $v$
       because these two letters are set to the same value
       (namely, to $h+1$).
 \item If $k > \abs{q}$, then a similar argument works (using Phase~I instead).
 \item If $k = \abs{q}$, then recall from Remark~\ref{rmk:order-agnostic} that
       the two phases can be arbitrarily interleaved.
       In particular, we can first perform all but the last step of Phase~I,
       then perform all but the last step of Phase~II,
       and finally perform the remaining two steps.
       The switch only affects these final two steps.
       However, the effect of these two steps is simply that the unique
       remaining unset $v_j$ with $j \in q$ gets set to $h$,
       and the unique remaining unset $v_j$ with $j \notin q$ gets set to $h+1$.
       The switch clearly does not change this behavior,
       since it does not depend on $i_k$ and $i_{k+1}$.
\end{itemize}
\end{proof}

Lemma~\ref{lemma:order_indep} states that the order between sites $i$ with equal $u_i$ does not matter.

\begin{remark}
\label{rmk:t-splitting}
Let $u$ and $q$ be as before. Let $r = \abs{q}$.
There exists a $t \in \ive{\ell}$ such that
$
p_{t-1} \leq r \leq p_t.
$
The word $v = q(u)$ then has type
\begin{equation}
\label{eq:queue_type_change}
(m_1, \dots, m_{t-1}, r-p_{t-1}, p_{t}-r, m_{t+1}, m_{t+2}, \ldots).
\end{equation}
Note that $p_{t} - r = m_{t} + (p_{t-1} - r)$.
We think of this as splitting the class $t$ into two new classes $t$ and $t+1$. % and so we call $t$ the \defn{splitting class} of $q(u)$.

For all $i$ processed in Phase~I (resp.\ Phase~II) of the algorithm, we have $u_i \geq t$ (resp.~$u_i \leq t$).
The queue $q$ can be reconstructed from $v$ and $t$ as the set of all $j \in \ive{n}$ satisfying $v_j \leq t$.
\end{remark}

\begin{example}
\label{ex:first_queue}
We consider the $4$-queue $q = \{1, 4, 8, 9\}$, and let $u = 346613321$.
Thus, the type of $u$ is $\mm = (2, 1, 3, 1, 0, 2, 0, \ldots)$ with $p_2 = 3$ and $p_3 = 6$.
Thus, the $t$ in Remark~\ref{rmk:t-splitting} equals $3$.
To compute $q(u)$, draw the following diagram
(whose upper row shows $u$, whose lower row shows $q(u)$,
and whose middle row represents the set $q$ by balls in the positions of its elements):
\[
\begin{tikzpicture}[>=latex,rounded corners,yscale=1.5,xscale=1.2,baseline=0]
\def\passwidth{3pt};
\node (i1) at (1,1) {$3$};
\node (i2) at (2,1) {$4$};
\node (i3) at (3,1) {$6$};
\node (i4) at (4,1) {$6$};
\node (i5) at (5,1) {$1$};
\node (i6) at (6,1) {$3$};
\node (i7) at (7,1) {$3$};
\node (i8) at (8,1) {$2$};
\node (i9) at (9,1) {$1$};
\node (t1) at (1,-1) {$2$};
\node (t2) at (2,-1) {$7$};
\node (t3) at (3,-1) {$7$};
\node (t4) at (4,-1) {$3$};
\node (t5) at (5,-1) {$4$};
\node (t6) at (6,-1) {$4$};
\node (t7) at (7,-1) {$5$};
\node (t8) at (8,-1) {$1$};
\node (t9) at (9,-1) {$1$};
\node[circle,draw=black] (q1) at (1,0) {};
\node[circle,draw=black] (q2) at (4,0) {};
\node[circle,draw=black] (q3) at (8,0) {};
\node[circle,draw=black] (q4) at (9,0) {};
\draw[->,red] (i4) -- (4,0.5) .. controls (3.8,0.2) and (3.5,0) .. (3.1,0) -- (2,0) -- (t2);
\draw[->,red] (i3) -- (t3);
\draw[->,red] (i2) -- (2,0.15) .. controls (1.8,-0.2) and (1.6,-0.25) .. (1.3,-0.25) -- (0,-0.25);
\draw[>->,red] (10,-0.25) -- (8,-0.25) -- (7,-0.25) -- (t7);
\draw[->,red] (i6) -- (t6);
\draw[->,red] (i7) -- (7,0) -- (5,0) -- (t5);
\draw[white,line width=\passwidth] (5,0.28) -- (7.3,0.28) .. controls (7.7,0.28) and (7.85,0.12) .. (q3);  % To simulate underpass
\draw[->,blue] (i5) -- (5,0.28) -- (7.3,0.28) .. controls (7.7,0.28) and (7.85,0.12) .. (q3);
\draw[white,line width=\passwidth] (q3) -- (t8);  % To simulate underpass
\draw[->,blue] (q3) -- (t8);
\draw[->,blue] (i9) -- (q4);
\draw[white,line width=\passwidth] (q4) -- (t9);  % To simulate underpass
\draw[->,blue] (q4) -- (t9);
\draw[white,line width=\passwidth] (1,0.28) -- (3.3,0.28) .. controls (3.7,0.28) and (3.85,0.12) .. (q2);  % To simulate underpass
\draw[->,blue] (i1) -- (1,0.28) -- (3.3,0.28) .. controls (3.7,0.28) and (3.85,0.12) .. (q2);
\draw[->,blue] (q2) -- (t4);
\draw[white,line width=\passwidth] (i8) -- (8,0.28) -- (10,0.28);  % To simulate underpass
\draw[->,blue] (i8) -- (8,0.28) -- (10,0.28);
\draw[>->,blue] (0,0.28) -- (0.3,0.28) .. controls (0.7,0.28) and (0.85,0.12) .. (q1);
\draw[white,line width=\passwidth] (q1) -- (t1);  % To simulate underpass
\draw[->,blue] (q1) -- (t1);
\end{tikzpicture}
\]
where the paths in red correspond to Phase I and those in blue are from Phase II. Hence, we have $q(346613321) = 277344511$, which has type $(2,1,1,2,1,0,2,\ldots)$.
\end{example}

We illustrate the situation $v = q(u)$ with a $2 \times n$ array, where the first row is the word $u$
and the second row has a circle labeled $v_j$ for $j \in q$ or a square labeled $v_j$ for $j \notin q$ in position $j$.
Using this convention, we can write Example~\ref{ex:first_queue} as
\[
\begin{tikzpicture}[baseline=10]
  \def\ll{0.65}   % level 2
  \foreach \i in {5,9} { \node at (\i,\ll) {$1$}; }
  \foreach \i in {8} { \node at (\i,\ll) {$2$}; }
  \foreach \i in {1,6,7} { \node at (\i,\ll) {$3$}; }
  \foreach \i in {2} { \node at (\i,\ll) {$4$}; }
  \foreach \i in {3,4} { \node at (\i,\ll) {$6$}; }
  \foreach \i in {1,4,8,9} { \draw (\i,0) circle (0.3); }
  \foreach \i in {2,3,5,6,7} { \draw (\i-.3,0-.3) rectangle +(0.6,+0.6); }
  \foreach \i in {8,9} { \node at (\i,0) {$1$}; }
  \foreach \i in {1} { \node at (\i,0) {$2$}; }
  \foreach \i in {4} { \node at (\i,0) {$3$}; }
  \foreach \i in {5,6} { \node at (\i,0) {$4$}; }
  \foreach \i in {7} { \node at (\i,0) {$5$}; }
  \foreach \i in {2,3} { \node at (\i,0) {$7$}; }
\end{tikzpicture}
\]

\begin{comment}  % s-flow only seems to be used in this paragraph
Consider a pair $k, k+1 \pmod{n}$ of consecutive columns.
For $s > t$ the \defn{$s$-flow} from $k+1$ to $k$ is the number of $i$ such that $u_i=s$, and whose queueing interval $\inter[j,i]$ contains both $k$ and $k+1$.
Similarly, for $s < t$, the \defn{$s$-flow} from $k$ to $k+1$ is the number of $i$ such that $u_i = s$, and whose queueing interval $\inter[i,j]$ contains both $k$ and $k+1$.
\end{comment}

There is a natural duality in the algorithm above.
For each queue $q$, let $q^*$ be the \defn{contragredient dual queue}, defined by $\tup{i \in q^*} \Longleftrightarrow \tup{n+1-i \notin q}$.
Similarly, for each word $u$ with $\ell$ classes, let $u^*$ be the \defn{contragredient dual word} defined by $u^*_i = \ell + 1 - u_{n+1-i}$.
For a fixed $k \in \ive{\ell}$, we call $\ell + 1 - k$ the \defn{contragredient dual letter} of $k$.
Note that if $q$ is an $r$-queue, then $q^*$ is the $(n-r)$-queue obtained by reflecting $[n] \setminus q$ through the middle of $[n]$.
Similarly, $u^*$ is obtained by reversing the word $u$ and taking the contragredient dual letters.

\begin{lemma}[Contragredient duality]
  \label{le:dual}
  Let $q$ be a queue and $u$ be a word with $\ell$ classes.
  Then we have $\bigl(q(u) \bigr)^* = q^*(u^*)$, \textit{i.e.}, we have $q(u)_i = \ell + 2 - q^*(u^*)_{n+1-i}$ for all $i$.
\end{lemma}

Here, we treat $q(u)$ as a word with $\ell+1$ classes, even if it may have only $\ell$ classes (in the degenerate case when $q = \ive{n}$).

\begin{proof}
Phase~I (resp.~II) in the construction of $q(u)$ corresponds to Phase~II (resp.~I) in the construction of $q^*(u^*)$ when the word is reversed and the letters are replaced by their contragredient duals.
Hence the claim follows.
\end{proof}

%\begin{remark} (Excision)
%  Fix a queue $q$ and a word $u$, and let $i,j$ be columns. Suppose that the $s$-flow from $j+1$ to $j$ equals the $s$-flow from $i+1$ to $i$ for each $s > t$, and that the $s$-flow from $i$ to $i+1$ equals the $s$-flow from $j$ to $j+1$ for each $s < t$. Then we have $q_{|\inter[i,j]^c}(u_{|\inter[i,j]^c}) = \bigl( q(u) \bigr)_{|\inter[i,j]^c}$. Here, for a (cyclic) word $u$, we let $u_{|\inter[i,j]^c}$ denote the (cyclic) word gotten from simply removing the closed (cyclic) interval $\inter[i,j]$, and similarly for $q_{|\inter[i,j]^c}$.
%\end{remark}


%%%%%%%%%%
\subsection{Multiline queues}

We now give our main definition of a multiline queue and spectral weight.

\begin{dfn}
For $\sigma \in \SymGp{\ell-1}$, a \defn{$\sigma$-twisted multiline queue (MLQ) of type $\mm = \tup{m_1, m_2, \ldots, m_\ell, 0, 0, \ldots}$}, with $\ell$ classes, is a sequence of queues $\qq = (q_1, \dotsc, q_{\ell-1})$ such that $q_i$ is a $p_{\sigma(i)}(\mm)$-queue and $m_{\ell} = n - p_{\ell-1}(\mm)$ (that is, $p_\ell(\mm) = n$).
When $\sigma$ is the identity permutation, we simply call $\qq$ an \defn{(ordinary) MLQ of type $\mm$}.
Define the \defn{weight} by $\wt(\qq) := \prod_{i=1}^{\ell-1} \wt(q_i)$.
We also consider $\qq$ as a function on words by
\[
\qq(u) := q_{\ell-1}\bigl( \cdots q_2\bigl( q_1(u) \bigr) \cdots \bigr).
\]
\end{dfn}

\begin{remark}
Our notion of an (ordinary) MLQ is equivalent to what is called a ``discrete MLQ'' in~\cite[\S 2.2]{AasLin17}, where we recover the labelling of level $k$ by $q_k( \cdots q_1(1 \dotsm 1) \cdots )$.
We omit the word ``discrete'' as these are the only MLQs in this note.
\end{remark}

\begin{dfn}
For $\sigma \in \SymGp{\ell-1}$ and a packed word $u$ of type $\mm$ with $\ell$ classes, we define the \defn{$\sigma$-spectral weight} or \defn{$\sigma$-amplitude} as
\begin{equation}
\label{eq:amplitude}
  \swt{u}_{\sigma} := \sum_{\qq} \wt(\qq),
\end{equation}
where the sum is over all $\sigma$-twisted MLQs $\qq$ of type $\mm$ satisfying $u = \qq(1 \dotsm 1)$.
(Here, $1 \dotsm 1$ denotes the word in $\mcW_n$ whose all letters are $1$.)
When $\sigma = \id$ is the identity permutation, we simply call this the \defn{spectral weight} or \defn{amplitude} and denote it by $\swt{u} := \swt{u}_{\id}$.
\end{dfn}

\begin{remark}
\label{rmk:mlq-type}
Note that the type of the word $\qq(1 \dotsm 1)$ is the type of the ($\sigma$-twisted) MLQ $\qq$.
\end{remark}

\begin{proof}
Write the $\sigma$-twisted MLQ $\qq$ as $\tup{q_1, \ldots, q_{\ell-1}}$.
Let $\mm = \tup{m_1, m_2, \ldots, m_\ell, 0, 0, \ldots}$ be the type of $\qq$.
Thus, $m_1 + m_2 + \cdots + m_\ell = p_{\ell}(\mm) = n$.
Now, the word $1 \dotsm 1$ has type $\tup{n, 0, 0, \ldots} = \tup{m_1 + m_2 + \cdots + m_\ell, 0, 0, \ldots}$
(since $n = m_1 + m_2 + \cdots + m_\ell$).
Every time we apply one of the queues $q_i$ to this word, the type changes in a simple way: Namely, the plus sign between $m_{\sigma(i)}$ and $m_{\sigma(i)+1}$ turns into a comma (so, for example, the application of $q_1$ transforms it into $\tup{m_1 + m_2 + \cdots + m_{\sigma(1)}, m_{\sigma(1)+1} + m_{\sigma(1)+2} + \cdots + m_\ell, 0, 0, \ldots}$).
Hence, the action of $\qq$ transforms $1 \dotsm 1$ into a word whose type has all the plus signs replaced by commas -- \textit{i.e.}, whose type is $\tup{m_1, m_2, \ldots, m_\ell, 0, 0, \ldots} = \mm$.
In other words, the type of the word $\qq(1 \dotsm 1)$ is $\mm$.
\end{proof}
\Darij{The above proof -- which I don't find obvious -- is a bit informal. To make it more rigorous would take me another definition -- the ``p-sequence'' of a type $\mm$, which is defined to be $\tup{p_0(\mm), p_1(\mm), p_2(\mm), \ldots}$ (and which uniquely determines $\mm$). Using this p-sequence, we observe that the action of a queue on a word merely inserts the size of the queue into the p-sequence at the appropriate position (``insort''), so by applying $\qq$ to $11\cdots 1$ we will end up with a word that has the same p-sequence as $\mm$ and therefore the type $\mm$.}
\Travis{This is really just repeated applications of~\eqref{eq:queue_type_change} and induction on the number of queues.}



%%%%%%%%%%
\subsection{Symmetric polynomials}

We also need the \defn{elementary symmetric polynomials} and \defn{complete homogeneous symmetric polynomials}.
Recall that they are defined for each $N \in \left\{0,1,\ldots,n\right\}$ and $k \geq 0$ by
\begin{align*}
e_k(x_1, x_2, \dotsc, x_N) & = \sum_{1 \leq i_1 < \cdots < i_k \leq N} x_{i_1} \dotsm x_{i_k},
\\ h_k(x_1, x_2, \dotsc, x_N) & = \sum_{1 \leq i_1 \leq \cdots \leq i_k \leq N} x_{i_1} \dotsm x_{i_k},
\end{align*}
respectively.
We define $e_k(x_1, \dotsc, x_N) = 0$ and $h_k(x_1, \dotsc, x_N) = 0$ for $k < 0$.
For more details on symmetric polynomials, we refer the reader to~\cite[Ch.~7]{Stanley-EC2}.








%=====================================================================
\section{Main results}
\label{sec:result}


In this section, we state our main results and use them to prove the commutativity conjecture of~\cite{AAMP} and~\cite[Conj.~3.10]{AasLin17}.

\begin{thm}
\label{thm:permutation}
  Let $u$ be a packed word of type $\mm$ with $\ell$ classes.
  For any $\sigma \in \SymGp{\ell-1}$, we have 
  \[
  \swt{u} = \swt{u}_{\sigma}.
  \]
\end{thm}

We will give the proof of Theorem~\ref{thm:permutation} in Section~\ref{sec:thm_proof}.
In order to prove our next result, we need the following.

If $w$ is a word of type $\mm$, and if $j \geq 0$, then $p_j(\mm)$ is the number of letters $\leq j$ in $w$.

For a word $w$ and a nonnegative integer $k$, we let \defn{$\vee^{(k)} w$} be the word obtained from $w$ by decrementing (by $1$) all but the $k$ smallest letters of $w$.
This is only well-defined if these $k$ smallest letters are determined uniquely and the remaining $n-k$ letters are $> 1$.
In other words, this is only well-defined if $k \in \set{ p_j(\mm) \mid j \geq 1 }$, where $\mm$ is the type of $w$.
Note that $\vee^{(k)} w = \merge{j} w$, where $j$ is such that $k = p_j(\mm)$.
% Note that $j$ is not necessarily unique, in which case $w$ is not a packed word, but the result is independent of the choice of $j$.

% \Travis{I am becoming less convinced of this notation as it makes things less explicit.
% Well-definedness is equivalent to the existence of a $j$ such that $p_j(\mm) = k$, and we really want to do the $j$-merge.
% It might be a little extra verbage, but I feel like it means more details and concepts are on the surface.}

\begin{lemma}
\label{lemma:queue_merge_commute}
Let $u \in \mcW_n$ be a word of type $\mm$.
Let $k \in \set{ p_j(\mm) \mid j \geq 1 }$.
If $q$ is a queue, then
\[
\vee^{(k)} q(u) = q(\vee^{(k)} u).
\]
In particular, both $\vee^{(k)} q(u)$ and $\vee^{(k)} u$ are well-defined.
\end{lemma}

\begin{proof}
The word $\vee^{(k)} u$ is well-defined since $k = p_j(\mm)$ for some $j \geq 1$;
furthermore, $\vee^{(k)} q(u)$ is well-defined since the type $\nn$ of $q(u)$
satisfies
\[
k \in \set{ p_j(\mm) \mid j \geq 1 } \subseteq \set{ p_j(\mm) \mid j \geq 1 } \cup \set{\abs{q}} = \set{ p_j(\nn) \mid j \geq 1 }.
\]
Thus, it remains to prove $\vee^{(k)} q(u) = q(\vee^{(k)} u)$.
The permutation $\tup{i_1, i_2, \dotsc, i_n}$ in the construction of $q(u)$
also works for the construction of $q(\vee^{(k)} u)$,
since $(\vee^{(k)} u)_a \leq (\vee^{(k)} u)_b$ whenever $u_a \leq u_b$.
Consequently, the construction of $q(\vee^{(k)} u)$ proceeds exactly like
the construction of $q(u)$ (with the same entries being set in the same
order), except that all but the $k$ smallest letters are now smaller by $1$.
Hence, $q(\vee^{(k)} u)$ is obtained from $q(u)$ by decrementing (by $1$)
all but the $k$ smallest letters of $q(u)$.
% (since $\vee^{(k)} u$ is obtained in this way from $u$).
However, the word $\vee^{(k)} q(u)$ is obtained from $q(u)$ in exactly the same way.
Therefore, we have $\vee^{(k)} q(u) = q(\vee^{(k)} u)$ as claimed.
\end{proof}

\begin{example}
Consider $q = \set{1,4,5,9,10}$ and $v = 3455313321$:
\[
\begin{tikzpicture}[baseline=-7]
  \def\ll{0.65}   % level 2
  \foreach \i in {6,10} { \node at (\i,\ll) {$1$}; }
  \foreach \i in {9} { \node at (\i,\ll) {$2$}; }
  \foreach \i in {1,5,7,8} { \node at (\i,\ll) {$3$}; }
  \foreach \i in {2} { \node at (\i,\ll) {$4$}; }
  \foreach \i in {3,4} { \node at (\i,\ll) {$5$}; }
  \foreach \i in {1,4,5,9,10} { \draw (\i,0) circle (0.3); }
  \foreach \i in {2,3,6,7,8} { \draw (\i-.3,0-.3) rectangle +(0.6,+0.6); }
  \foreach \i in {9,10} { \node at (\i,0) {$1$}; }
  \foreach \i in {1} { \node at (\i,0) {$2$}; }
  \foreach \i in {4,5} { \node at (\i,0) {$3$}; }
  \foreach \i in {6,7} { \node at (\i,0) {$4$}; }
  \foreach \i in {8} { \node at (\i,0) {$5$}; }
  \foreach \i in {2,3} { \node at (\i,0) {$6$}; }
\end{tikzpicture}\ .
\]
Let $u = 3566413321$, and note that $v = \merge{3} u = \vee^{(6)} u$ and
\[
\begin{tikzpicture}[baseline=-7]
  \def\ll{0.65}   % level 2
  \foreach \i in {6,10} { \node at (\i,\ll) {$1$}; }
  \foreach \i in {9} { \node at (\i,\ll) {$2$}; }
  \foreach \i in {1,7,8} { \node at (\i,\ll) {$3$}; }
  \foreach \i in {5} { \node at (\i,\ll) {$4$}; }
  \foreach \i in {2} { \node at (\i,\ll) {$5$}; }
  \foreach \i in {3,4} { \node at (\i,\ll) {$6$}; }
  \foreach \i in {1,4,5,9,10} { \draw (\i,0) circle (0.3); }
  \foreach \i in {2,3,6,7,8} { \draw (\i-.3,0-.3) rectangle +(0.6,+0.6); }
  \foreach \i in {9,10} { \node at (\i,0) {$1$}; }
  \foreach \i in {1} { \node at (\i,0) {$2$}; }
  \foreach \i in {4,5} { \node at (\i,0) {$3$}; }
  \foreach \i in {6} { \node at (\i,0) {$4$}; }
  \foreach \i in {7} { \node[red] at (\i,0) {$5$}; }
  \foreach \i in {8} { \node[dgreencolor] at (\i,0) {$6$}; }
  \foreach \i in {2,3} { \node[dgreencolor] at (\i,0) {$7$}; }
\end{tikzpicture}\ ,
\]
where we have $2663344511 = \merge{4} 2773345611 = \vee^{(6)} 2773345611$.
Similarly, let $u' = 4566413421$, and note that $v = \merge{3} u'$ and
\[
\begin{tikzpicture}[baseline=-7]
  \def\ll{0.65}   % level 2
  \foreach \i in {6,10} { \node at (\i,\ll) {$1$}; }
  \foreach \i in {9} { \node at (\i,\ll) {$2$}; }
  \foreach \i in {7} { \node at (\i,\ll) {$3$}; }
  \foreach \i in {1,5,8} { \node at (\i,\ll) {$4$}; }
  \foreach \i in {2} { \node at (\i,\ll) {$5$}; }
  \foreach \i in {3,4} { \node at (\i,\ll) {$6$}; }
  \foreach \i in {1,4,5,9,10} { \draw (\i,0) circle (0.3); }
  \foreach \i in {2,3,6,7,8} { \draw (\i-.3,0-.3) rectangle +(0.6,+0.6); }
  \foreach \i in {9,10} { \node at (\i,0) {$1$}; }
  \foreach \i in {1} { \node at (\i,0) {$2$}; }
  \foreach \i in {4} { \node[blue] at (\i,0) {$3$}; }
  \foreach \i in {5} { \node[dgreencolor] at (\i,0) {$4$}; }
  \foreach \i in {6,7} { \node[dgreencolor] at (\i,0) {$5$}; }
  \foreach \i in {8} { \node[dgreencolor] at (\i,0) {$6$}; }
  \foreach \i in {2,3} { \node[dgreencolor] at (\i,0) {$7$}; }
\end{tikzpicture}\ ,
\]
where we have $2663344511 = \merge{4} 2773455611$.
\end{example}

\begin{lemma}
\label{lemma:queue_merge}
  Let $q'$ be a $p_i(\mm)$-queue for some type $\mm$ and some $i \geq 1$.
  Let the type $\mm$ have $\ell$ classes, and let $\sigma \in \SymGp{\ell-1}$.
  % be such that $\sigma(j) = j$ for all $j \geq i$.
  Let $\qq$ be a $\sigma$-twisted MLQ of type $\merge{i}\mm$.
  % Darij: Yes, we need $\sigma$-twisted here, due to how we apply this
  % lemma repeatedly in the proof of Theorem \ref{thm:determinant_form}.
  % (To apply it repeatedly, we need $\sigma$-twisted MLQs, since an
  % MLQ might become $\sigma$-twisted after the first application.)
  For the word
  $
  u = \qq\bigl( q'(1 \dotsm 1) \bigr),
  $
  we have
  \[
  \qq(1 \dotsm 1) = \merge{i} u.
  \]
\end{lemma}

\begin{proof}
\begin{comment}
Let us first show an auxiliary observation.
Let $q$, $u$ and $t$ be as in Remark~\ref{rmk:t-splitting},
and let $h \in \set{1, 2, \ldots}$.
The permutation $\tup{i_1, i_2, \ldots, i_n}$ in the construction of $q(u)$
also works for the construction of $q(\merge{h} u)$,
since $(\merge{h} u)_a \leq (\merge{h} u)_b$ whenever $u_a \leq u_b$.
Thus, the construction of $q(\merge{h} u)$ proceeds exactly as the
construction of $q(u)$, except that the letters used to build
the former word are those of $\merge{h} u$ instead of those of $u$.
This yields an expression for each letter $(q(\merge{h} u))_i$ of
$q(\merge{h} u)$ depending on whether ...
\begin{equation}
 q(\merge{h} u) = \begin{cases}
                   \merge{h} q(u) , & \text{ if } h < t ; \\
                   \merge{h+1} q(u) , & \text{ if } h \geq t
                  \end{cases} .
\label{pf.lemma:queue_merge.1}
\end{equation}
\end{comment}
Write the $\sigma$-twisted MLQ $\qq$ as $\tup{q_1, \ldots, q_{\ell-1}}$.
It has type $\merge{i} \mm$.

% Thus, the queue $q_j$ has size
% $p_{\sigma(j)}(\merge{i} \mm) = p_{\sigma(j)}(\mm)$
% for each $j < i$
% (here, we have used the fact that $j < i$ entails
% $\sigma(j) < i$;
% this is a consequence of our assumption on $\sigma$),
% and size
% $p_{\sigma(j)}(\merge{i} \mm) = p_j(\merge{i} \mm) = p_{j+1}(\mm)$
% for each $j \geq i$.

% The permutation
% $\zeta := s_{i-1} \cdots s_2 s_1 \in \SymGp{\ell-1}$ is the
% $i$-cycle sending $1, 2, \ldots, i$ to $i, 1, 2, \ldots, i-1$.
Set $\qq' := \tup{q', q_1, \ldots, q_{\ell-1}}$; this is easily
seen to be a $\zeta$-twisted MLQ of type $\mm$, for some
$\zeta \in \SymGp{\ell}$
(since the multiset of the $p_k(\merge{i}\mm)$ for $k \geq 1$
is precisely the multiset of the $p_k(\mm)$ for $k \geq 1$
with one copy of $p_i(\mm) = \abs{q'}$ removed).
Furthermore, the definition of $u$ becomes $u = \qq' (1 \dotsm 1)$.
Hence, the type of $u$ is $\mm$ (by Remark~\ref{rmk:mlq-type}).

Set $k = p_i(\mm)$. Then, $q'$ is a $k$-queue, so that the type
$\nn$ of the word $q(1 \dots 1)$ satisfies $p_1(\nn) = k$.
Hence, any word obtained by actions of queues on $q'(1 \dots 1)$
will have its type $\nn$ satisfy
$k \in \set{ p_j(\nn) \mid j \geq 0 } $.

Since the type of $u$ is $\mm$, and since $k = p_i(\mm)$, we have
\begin{equation}
\label{pf.lemma:queue_merge.4}
 \merge{i} u = \vee^{(k)} (u) = \vee^{(k)} \qq\bigl( q' (1 \dotsm 1) \bigr) = \qq\bigl( \vee^{(k)} q' (1 \dotsm 1) \bigr)
\end{equation}
by repeated use of Lemma~\ref{lemma:queue_merge_commute}
(since any word obtained by actions of queues on $q'(1 \dotsm 1)$
will have its type $\nn$ satisfy
$k \in \set{ p_j(\nn) \mid j \geq 1 } $).
It is clear that $\vee^{(k)} q'(1 \dotsm 1) = 1 \dotsm 1$,
and so~\eqref{pf.lemma:queue_merge.4} becomes $\qq(1 \dotsm 1) = \merge{i} u$.
\end{proof}

\begin{thm}
\label{thm:merge}
  Let $\mm$ be a type with $m_i \neq 0$ and $m_{i+1} \neq 0$.
  Let $v$ be a packed word of type $\merge{i}\mm$.
  Then,
  \[
  \swt{v} e_{p_i(\mm)}(x_1, \dotsc, x_n) = \sum_u \swt{u},
  \]
where we sum over all $u$ of type $\mm$ such that $v = \merge{i} u$.
\end{thm}

\begin{proof}
  The type $\mm$ is packed (since $m_i \neq 0$ and $m_{i+1} \neq 0$,
  and since $\merge{i}\mm$ is packed).
  Let $\merge{i}\mm$ have $\ell$ classes; then, $\mm$ has $\ell+1$
  classes.
  First note that
  \[
  \swt{v} e_{p_i(\mm)}(x_1, \dotsc, x_n) = \sum_{(\qq,q')} \wt(\qq) \wt(q'),
  \]
  where we sum over all pairs $(\qq, q')$ such that
  \begin{itemize}
  \item $\qq = (q_1, \dotsc, q_{\ell-1})$ is an MLQ of type $\merge{i}\mm$ such that $v = \qq(1\cdots1)$ and
  \item $q'$ is a $p_i(\mm)$-queue.
  \end{itemize}
  Given any such pair $\tup{\qq, q'}$, we set
  \[
  \theta(\qq, q') := (q', q_1, \dotsc, q_{\ell-1});
  \]
  the result is a $(s_{i-1} \dotsm s_2 s_1)$-twisted MLQ of type $\mm$ with weight
  $\wt\bigl( \theta(\qq, q') \bigr) = \wt(\qq) \wt(q')$.
  But recall that $v = \qq(1 \dotsm 1$); thus, by Lemma~\ref{lemma:queue_merge}, we have
  \[
  v = \qq(1 \dotsm 1) = \merge{i} \qq\bigl( q'(1 \dotsm 1) \bigr) = \merge{i} \bigl( \theta(\qq, q')(1 \dotsm 1) \bigr).
  \]
  Thus, we have defined a weight preserving bijection $\theta$ from the set of all pairs $(\qq, q')$ as above
  to the set of all $(s_{i-1} \dotsm s_1)$-twisted MLQs $\widetilde{\qq}$ of type $\mm$ satisfying $v = \merge{i} \widetilde{\qq} \tup{1 \dotsm 1}$.
  Hence, we have
  \[
  \sum_{(\qq,q')} \wt(\qq) \wt(q')
  = \sum_{\widetilde{\qq}} \wt(\widetilde{\qq})
  = \sum_u \swt{u}_{s_{i-1} \dotsm s_1} ,
  \]
  where the last sum is over all words $u$ of type $\mm$ satisfying $v = \merge{i} u$.
  Finally, we have $\swt{u}_{s_{i-1} \dotsm s_1} = \swt{u}$ for all such $u$ by Theorem~\ref{thm:permutation}.
  Combining all the above equalities, we find $\swt{v} e_{p_i(\mm)}(x_1, \dotsc, x_n) = \sum_u \swt{u}$.
\end{proof}

\begin{remark}
\label{rmk:bijective_proof}
Our proof of Theorem~\ref{thm:permutation} is by constructing a bijection $\omega$, and hence, we can give a bijective proof of Theorem~\ref{thm:merge} by the composition $\omega \circ \theta$.
\end{remark}


\begin{example}
Suppose $n = 5$.
Let $v = 13234$, and we have that $v = \merge{3} u$ if and only if $u \in \set{13245, 14235}$.
By examining all possible MLQs for these words, we obtain
\begin{align*}
\swt{13234} & = x_1 x_2 x_3^2 x_4 (x_1^2 + x_1 x_4 + x_1 x_5 + x_4 x_5 + x_5^2),
\\ \swt{13245} & = x_1 x_2 x_3^2 x_4 (x_1^2 + x_1x_4 + x_1x_5 + x_4^2 + x_4x_5 + x_5^2)
\\ & \hspace{20pt} \times (x_1x_2x_3 + x_1x_2x_5+x_1x_3x_5+x_2x_3x_5),
\\ \swt{14235} & = x_1x_2x_3^2x_4^2 (x_1^3x_2 + x_1^3x_3 + x_1^3x_5 + x_1^2x_2x_3 + x_1^2x_2x_4 + 2x_1^2x_2x_5
\\ & \hspace{60pt} + x_1^2x_3x_4 + 2x_1^2x_3x_5 + x_1^2x_4x_5 + x_1^2x_5^2 + x_1x_2x_3x_5
\\ & \hspace{60pt} + x_1x_2x_4x_5 + 2x_1x_2x_5^2 + x_1x_3x_4x_5 + 2x_1x_3x_5^2 + x_1x_4x_5^2
\\ & \hspace{60pt} + x_1x_5^3 + x_2x_3x_5^2 + x_2x_4x_5^2 + x_2x_5^3 + x_3x_4x_5^2 + x_3x_5^3).
\end{align*}
(We have factored the expressions for readability only.)
We verify Theorem~\ref{thm:merge} in this case by computing $\swt{13234} e_3(x_1, x_2, x_3, x_4, x_5) = \swt{13245} + \swt{14235}$.
\end{example}








%=====================================================================
\section{A Jacobi-Trudi-like formula for special $u$}
\label{sec:JT_formula}

We shall now prove a determinantal formula for $\swt{u}$ when $u$ is a packed word with either $\ell-1$ or $\ell$ classes and weakly decreasing if we disregard all letters $\ell$.

\begin{dfn}
\label{def:near_std}
Define the \defn{$k$-near standardization} of a word $u \in \mcW_n$ of type $\mm$ to be the word $\std{u} := \std{u}_1 \cdots \std{u}_{n}$ obtained as follows.
Define
\[
W := \{ w_1 > w_2 > \cdots > w_r \mid u_{w_i} < k \}
\]
such that $u_j \geq k$ for all $j \in \ive{n} \setminus W$.
Let $r = \abs{W}$ and set
\[
\std{u}_i = \begin{cases}
j & \text{if } u_i < k \text{ and } i = w_j \\
r + 1 & \text{otherwise.}
\end{cases}
\]
That is to say, the $k$-near standardization $\std{u}$ is obtained by replacing the $j$-th letter that is not $k$ read right-to-left with $j$ and all letters $k$ with $r + 1$.
We say the \defn{near standardization} of a word with $\ell$ classes to be the $\ell$-near standardization.
\end{dfn}

Note that the $k$-near standardization is order preserving in the sense that $1 \leq i < j \leq n$ satisfy $u_i \geq u_j$ if and only if either $\std{u}_i > \std{u}_j$ or $\std{u}_i = \std{u}_j = r+1$.
Additionally, note that the type of the near standardization of a word $u$ with $\ell$ classes is $\widetilde{\mm} = (\widetilde{m}_1, \widetilde{m}_2, \ldots, \widetilde{m}_{r+1}, 0, 0, \ldots)$ with $\widetilde{m}_i = 1$ for $i \leq r$ and $\widetilde{m}_{r+1} = m_k$.

\begin{example}
For $k = 4$, we have
\begin{align*}
u & = {\color{gray} 4}3{\color{gray} 44}33{\color{gray} 4}22{\color{gray} 4}211{\color{gray} 4},
\\ \std{u} & = {\color{gray} 9}8{\color{gray} 99}76{\color{gray} 9}54{\color{gray} 9}321{\color{gray} 9}.
\end{align*}
\end{example}

\begin{thm}
\label{thm:determinant_form}
  Let $B = \set{b_1 < b_2 < \cdots < b_r} \subseteq \ive{n}$.
  Let $v_1v_2 \dotsm v_r$ be a weakly decreasing (non-cyclic) packed word of length $r$ with $\ell-1$ classes.
  Define a word $u$ of length $n$ by $u_i = v_j$ if $i = b_j$ for some $j$, otherwise $u_i = \ell$.
  Then
  \[
  \swt{u} = \left( \prod_{i\in B} x_i \right) \det\bigl( h_{i-j-1+\gamma_j}(x_1, \dotsc, x_{b_j}) \bigr)_{1\leq i,j\leq r}\,,
  \]
  where $\gamma_j$ is the number of distinct letters in $v_1 \dotsm v_j$.
\end{thm}

%For the proof of this theorem, we need to lay some groundwork.
%
%\begin{dfn}
%If $k$ is a positive integer, then a \defn{$k$-frow} will mean a word $w \in \mcW_n$ such that:
%\begin{itemize}
% \item $w_i \leq k$ for all $i \in \ive{n}$;
% \item each of the letters $1,2,\ldots,k-1$ appears at least once in $w$;
% \item removing all letters $k$ from $w$ yields a weakly decreasing word.
%\end{itemize}
%\end{dfn}
%
%For example, $43443342242114$ is a $4$-frow; so is $3321$ (we don't require $k$ to appear in $w$).
%Note that the word $u$ in Theorem~\ref{thm:determinant_form} is an $\ell$-frow.

\begin{proof}
Let $\qq = \tup{q_1, \ldots, q_{\ell-1}}$ be any MLQ appearing in the sum $\swt{u}$.
Thus, $\qq (1 \dotsm 1) = u$, and the type of $\qq$ is the type $\mm = (m_1, m_2, \ldots, m_\ell, 0, 0, \ldots)$ of $u$.
In particular,
$\abs{q_{\ell-1}} = p_{\ell-1}(\mm) = r = \abs{B}$.
Since the positions of the smallest $\abs{B}$ entries of $u$
are exactly the sites in $B$, this entails that
$q_{\ell-1} = B$.
Hence, $\wt(q_{\ell-1}) = \prod_{i\in B} x_i$.
Thus, the factor $\prod_{i\in B} x_i$ appears in each addend of $\swt{u}$;
we shall disregard this factor in the following.

Let $\std{u}$ be the near standardization of $u$, and note that $W = B$ from Definition~\ref{def:near_std} (but in the reverse order).
There exists $T$ such that $\bigvee_T \std{u} = u$.
Thus, from Lemma~\ref{lemma:queue_merge}, there exists some $\sigma$-twisted MLQ $\widetilde{\qq}'$ such that $\widetilde{\qq}'(1 \cdots 1) = \std{u}$, and from Theorem~\ref{thm:permutation}, there exists a corresponding MLQ $\widetilde{\qq}$ such that $\widetilde{\qq}(1 \cdots 1) = \std{u}$.\footnote{This is essentially the same as the proof of Theorem~\ref{thm:merge}. Moreover, this is done bijectively; see also Remark~\ref{rmk:bijective_proof}.}
As shown in the proof of~\cite[Prop.~3.7]{AasLin17}, the MLQ $\widetilde{\qq}$ corresponds to disjoint $r$-paths with initial points $\iota_i := (0,i)$ and terminal points $(b_i,0)$.
Note that these are precisely the bully paths of~\cite{AasLin17}.
We claim it is sufficient to show that for every MLQ $\qq$, there exists unique disjoint $r$-paths $\{\rho_i\}_{i=1}^r$ such that $\rho_i$ passes through the point $\tau_i := (b_i, i - \gamma_i)$.
This follows by applying the \defn{Lindstr\"om--Gessel--Viennot (LGV) Lemma}~\cite{Lindstrom73,GV85} and considering the initial points $\{ \iota_i \}_{i=1}^r$ and terminal points $\{ \tau_i \}_{i=1}^r$.
We refer the reader to \cite[\S2]{GesVie89} for details on the LGV Lemma.\footnote{The version we shall use is \cite[Cor.~2]{GesVie89}.}

Therefore, given disjoint $r$-paths $\rho = \{ \rho_i \}_{i=1}^r$ with corresponding MLQ $\widetilde{\qq} = (\widetilde{q}_1, \dotsc, \widetilde{q}_r)$, we construct $\qq_{\rho} = (q_1, \dotsc, q_{\ell-1})$ by
\[
j \in q_i \text{ if and only if } j \in \widetilde{q}_{i+t-\gamma_t},
\]
where $t \in \ive{r}$ such that $b_t \leq j < b_{t+1}$ (with $b_{r+1} = \infty$).
Moreover, this map is invertible, where to construct the inverse, we first construct sets
\[
A_i := \left\{ a_{i,j} = \text{$i$-th largest entry in $q_j$} %= \max\bigl\{ q_j \setminus \{ a_{k,j} \mid K(j) \leq k < j \} \bigr\}
\mid K(i) \leq j <\ell \right\},
\]
where $K(i) := \min\{\kappa \mid i \leq \lvert q_{\kappa} \rvert \}$. We will use the convention that $a_{i,j} = a_{i,\ell-1}$ for all $j \geq \ell$.
This then forms the disjoint $r$-paths $\rho' = \{\rho'_i\}_{i=1}^r$ by
\begin{align*}
\rho'_i \colon (0,i) \to (a_{i,K(i)},i) & \to (a_{i,K(i)},i+1) \to (a_{i,K(i)+1},i+1) \to
\\ \cdots & \to (a_{i,\ell-1}, i + \ell - K(i)) = (b_i, i - \gamma_i).
\end{align*}
The fact that $\qq = \qq_{\rho'}$ follows from Lemma~\ref{lemma:queue_merge_commute}.
\end{proof}

\begin{figure}[t]
\[
\begin{tikzpicture}[xscale=1.3,yscale=0.9]
  \begin{scope}[yshift=7cm]
    \foreach \i in {1,...,9}{
      \foreach \j in {0,1,2}{
        \node at (\i,\j){$\cdot$};
      }
    }
    \node[circle,fill=white,draw=black] at  (1, 0){$3$};
    \node[circle,fill=white,draw=black,text=blue] at  (2, 0){$3$};
    \node[circle,fill=white,draw=black] at  (4, 0){$2$};
    \node[circle,fill=white,draw=black,text=blue] at  (6, 0){$2$};
    \node[circle,fill=white,draw=black,text=darkred] at  (7, 0){$2$};
    \node[circle,fill=white,draw=black] at  (9, 0){$1$};
    \node[circle,fill=white,draw=black] at  (3, 1){$2$};
    \node[circle,fill=white,draw=black,text=blue] at  (4, 1){$2$};
    \node[circle,fill=white,draw=black,text=darkred] at  (6, 1){$2$};
    \node[circle,fill=white,draw=black] at  (8, 1){$1$};
    \node[circle,fill=white,draw=black] at  (7, 2){$1$};
  \end{scope}

  \fill[black!10] (1,1) -- (1,2) -- (4,2) -- (4,3) -- (6,3) -- (6,4) -- (9,4) -- (9,1) -- cycle;
  \draw[densely dotted] (1,1) grid (9,6);

  \draw[thick,draw=red] (1,2)--(2,2);
  \draw[thick,draw=red] (1,3)--(3,3)--(3,2)--(4,2);
  \draw[thick,draw=red] (1,4)--(4,4)--(4,3)--(6,3);
  \draw[thick,draw=red] (1,5)--(6,5)--(6,4)--(7,4);
  \draw[thick,draw=red] (1,6)--(7,6)--(7,5)--(8,5)--(8,4)--(9,4);
  %\draw[thick,blue,dashed] (2,2) -- (2,1);
  %\draw[thick,blue,dashed] (4,2) -- (4,1);
  %\draw[thick,blue,dashed] (6,3) -- (6,1);
  %\draw[thick,blue,dashed] (7,4) -- (7,1);
  %\draw[thick,blue,dashed] (9,4) -- (9,1);
  
  \node[circle,fill=white,draw=black,inner sep=1pt] at (1,1) {$3$};
  \node[circle,fill=white,draw=black,text=blue,inner sep=1pt] at (2,2) {$3$};
  \node[circle,fill=white,draw=black,inner sep=1pt] at (4,2) {$2$};
  \node[circle,fill=white,draw=black,inner sep=1pt] at (3,3) {$2$};
  \node[circle,fill=white,draw=black,text=blue,inner sep=1pt] at (4,4) {$2$};
  \node[circle,fill=white,draw=black,text=blue,inner sep=1pt] at (6,3) {$2$};
  \node[circle,fill=white,draw=black,text=darkred,inner sep=1pt] at (6,5) {$2$};
  \node[circle,fill=white,draw=black,text=darkred,inner sep=1pt] at (7,4) {$2$};
  \node[circle,fill=white,draw=black,inner sep=1pt] at (7,6) {$1$};
  \node[circle,fill=white,draw=black,inner sep=1pt] at (8,5) {$1$};
  \node[circle,fill=white,draw=black,inner sep=1pt] at (9,4) {$1$};

  \foreach \i in {2,...,6} {
    \node at (1,\i) {\textbullet};
  }
  \foreach \i in {1,...,6} {
    \node[anchor=east,inner sep=7pt] at (1,7-\i) {$\iota_{\i}$};
  }
\end{tikzpicture}
\]
\caption{The bijection with  between MLQs and disjoint $r$-paths for Example~\ref{ex:NILP_bijection} as described in the proof of Theorem~\ref{thm:determinant_form}.}
\label{fig:lattice_path_bijection}
\end{figure}

\begin{example}
\label{ex:NILP_bijection}
Consider $n = 9$, $r = 6$, $\ell = 4$, $v = 332221$, and $B = \set{1,2,4,6,7,9}$.
Therefore, we have the word $u$ in Theorem~\ref{thm:determinant_form} and its near standardization
\begin{align*}
u & = 33{\color{gray} 4}2{\color{gray} 4}22{\color{gray} 4}1,
\\ \std{u} & = 65{\color{gray} 7}4{\color{gray} 7}32{\color{gray} 7}1.
\end{align*}
See Figure~\ref{fig:lattice_path_bijection} for an example of the resulting bijection between an MLQ and disjoint $r$-paths.
\end{example}

Now, fix a sequence $b_1 < b_2 < \cdots < b_r$, and for a permutation $v \in \SymGp{r}$, let $u(v)$ be the corresponding word as defined in Theorem~\ref{thm:determinant_form}.
Furthermore let $S \subseteq \ive{r-1}$ be such that $i\in S$ implies $i+1 \notin S$, and define the permutation $\sigma_S = \left( \prod_{i \in S} s_i \right) w_0$, where $s_i, w_0 \in \SymGp{r}$.
Note that the elements $\{s_i \mid i \in S\}$ all commute, so the product, and hence $\sigma_S$, is well-defined.
In~\cite[Conj.~3.10]{AasLin17}, a formula for the spectral weight $\swt{u \sigma_S}$ at $x_1 = \cdots = x_n = 1$ is conjectured, where $u \sigma_S = u_{\sigma_S(1)} \cdots u_{\sigma_S(r)}$.

Let $T \subseteq \ive{r-1}$, and let $\phi(T) = \sum_{S \subseteq T} \swt{u \sigma_S}$.
By Theorem~\ref{thm:permutation}, we have
\begin{align*}
  \psi(T) & = \left(\prod_{i\in S} e_{p_i(\mm)}(x_1, \dotsc, x_n) \right) \swt{ \bigvee_T w_0}
  \\ & = \left( \prod_{i\in B} x_i \right) \left(\prod_{i\in S} e_{p_i(\mm)}(x_1, \dotsc, x_n) \right) \det\bigl(h_{i-j+1+\gamma_j}(x_1, \dotsc, x_{b_j})\bigr)_{1\leq i,j \leq r},
\end{align*}
where $\gamma_i = i - \lvert \{j\in T \mid j < i \} \rvert$ and the second equality is by Theorem~\ref{thm:determinant_form}.
By M\"obius inversion we have $\swt{u \sigma_S} = \sum_{T\subseteq S} (-1)^{|S|-|T|} \psi(T)$.
Taken together with $x_1 = \cdots = x_n = 1$, this proves~\cite[Conj.~3.10]{AasLin17} (which is a generalization of~\cite[Conj.~3.9]{AasLin17}).
Additionally, this proves~\cite[Conj.~3.6]{AasLin17} (which is a generalization of~\cite[Conj.~3.4]{AasLin17}).










%=====================================================================
\section{The TASEP connection}
\label{sec:tasep}

We now explain how our proof of Theorem~\ref{thm:permutation} gives a proof of the commutativity conjecture of~\cite{AAMP}.

There are $2^{n-1}$ packed types for words of length $n$, as they are the compositions of $n$.
We let the subset $S \subseteq [n-1]$ correspond to the type of the word obtained by merging $i$ and $i+1$ in $12 \dotsm n$ for each $i \in S$.
Denote this type by $\mm_S$.
Note that $\set{p_1(\mm_S), \dotsc, p_{\ell-1}(\mm_S)} = [n-1] \setminus S$, where $\mm_S$ has $\ell$ classes; this is the complement of the usual bijection between subsets of $\ive{n-1}$ and compositions of $n$.
Let $\mcW_S$ denote the set of words of type $\mm_S$.
Let $V_S$ be the vector space over $\RR$ with basis $\set{\epsilon_w \mid w \in \mcW_S}$.

\begin{example}
  For $n = 4$, we have
  \[
  \begin{tikzpicture}[xscale=4.5,yscale=2,thick,>=latex]
  \node (E) at (1,0) {$\mbf{m}_{\emptyset} = (1,1,1,1)$};
  \node (1) at (2,1) {$\mbf{m}_{\{1\}} = (2,1,1)$};
  \node (2) at (1,1) {$\mbf{m}_{\{2\}} = (1,2,1)$};
  \node (3) at (0,1) {$\mbf{m}_{\{3\}} = (1,1,2)$};
  \node (12) at (2,2) {$\mbf{m}_{\{1,2\}} = (3,1)$};
  \node (13) at (1,2) {$\mbf{m}_{\{1,3\}} = (2,2)$};
  \node (23) at (0,2) {$\mbf{m}_{\{2,3\}} = (1,3)$};
  \node (123) at (1,3) {$\mbf{m}_{\{1,2,3\}} = (4)$};
  \draw[->,red] (E) -- (1);
  \draw[->,blue] (E) -- (2);
  \draw[->,dgreencolor] (E) -- (3);
  \draw[->,red] (2) -- (12);
  \draw[->,red] (3) -- (13);
  \draw[->,blue] (3) -- (23);
  \draw[->,blue] (1) -- (12);
  \draw[->,dgreencolor] (1) -- (13);
  \draw[->,dgreencolor] (2) -- (23);
  \draw[->,red] (23) -- (123);
  \draw[->,blue] (13) -- (123);
  \draw[->,dgreencolor] (12) -- (123);
  \end{tikzpicture}
  \]
  where we have drawn an arrow $\mm_S \to \mm_{S \cup \set{i}}$ for each $S \subseteq [n-1]$ and each $i \in [n-1] \setminus S$ (this is the Hasse diagram of the Boolean lattice of subsets of $[n-1]$).
\end{example}

The \defn{totally asymmetric simple exclusion process} (TASEP) is a Markov chain on $\mcW_S$, where $S \subseteq[n-1]$, as follows.
For a state $u \in \mcW_S$, we move to a new state by picking a random $i \in [n]$ and either
\begin{itemize}
\item if $u_i > u_{i+1}$, swap the positions $u_i$ and $u_{i+1}$, or
\item do nothing (\textit{i.e.} stay at $u$).
\end{itemize}
Let $M_S \colon V_S \to V_S$ be the transition matrix of this Markov chain.
Note that these moves preserve the type of the words; thus we could consider this as a Markov chain on $\mcW_n$, where $\mcW_S$ becomes an irreducible component.
For $i \notin S$, we have the merging map $\Phi_i \colon \mcW_S \to \mcW_{S\cup\{i\}}$ given by
$\Phi_i(\epsilon_u) = \epsilon_{\vee^{(i)} u}$.
%$\Phi_i(\epsilon_u) = \epsilon_{\merge{t}u}$, where $t = \min\set{k \mid p_k(\mm_S) \geq i}$.
It is easy to see that $\Phi_i M_S = M_{S\cup \{i\}} \Phi_i$. 

\begin{figure}
\[
\begin{tikzpicture}[>=stealth,thick,scale=0.8]
\node (321) at (3,8) {$321$};
\node (231) at (0,6) {$231$};
\node (312) at (6,6) {$312$};
\node (213) at (0,2) {$213$};
\node (132) at (6,2) {$132$};
\node (123) at (3,0) {$123$};
\draw[->,blue] (123) -- (321); % node[right,pos=0.8] {$1/3$};
\draw[->,dgreencolor] (132) -- (123); % node[above=3pt,pos=0.5] {$1/3$};
\draw[->,red] (132) -- (231); % node[below=4pt,pos=0.8] {$1/3$};
\draw[->,red] (213) -- (123); % node[above=3pt,pos=0.5] {$1/3$};
\draw[->,dgreencolor] (213) -- (312); % node[below=4pt,pos=0.8] {$1/3$};
\draw[->,blue] (231) -- (213); % node[left,pos=0.5] {$1/3$};
\draw[->,blue] (312) -- (132); % node[right,pos=0.5] {$1/3$};
\draw[->,dgreencolor] (321) -- (231); % node[above=3pt,pos=0.5] {$1/3$};
\draw[->,red] (321) -- (312); % node[above=3pt,pos=0.5] {$1/3$};
\end{tikzpicture}
\hspace{35pt}
\begin{tikzpicture}[>=stealth,thick,scale=0.8]
\node (1223) at (0,-2) {$1223$};
\node (3221) at (0,8) {$3221$};
\node (2321) at (2,6) {$2321$};
\node (3212) at (-2,6) {$3212$};
\node (2231) at (3,4) {$2231$};
\node (2312) at (0,4) {$2312$};
\node (3122) at (-3,4) {$3122$};
\node (2213) at (3,2) {$2213$};
\node (2132) at (0,2) {$2132$};
\node (1322) at (-3,2) {$1322$};
\node (1232) at (-2,0) {$1232$};
\node (2123) at (2,0) {$2123$};
\draw[->,blue] (1223) .. controls (2,3) and (1,6) .. (3221);
\draw[->,red] (3221) -- (3212);
\draw[->,dgreencolor] (3221) -- (2321);
\draw[->,dgreencolor] (2321) -- (2231);
\draw[->,red] (2321) -- (2312);
\draw[->,red] (3212) -- (3122);
\draw[->,dgreencolor] (3212) -- (2312);
\draw[->,blue] (3122) -- (1322);
\draw[->,blue] (2312) -- (2132);
\draw[->,blue] (2231) -- (2213);
\draw[->,dgreencolor] (1322) -- (1232);
\draw[->,red] (1322)  .. controls (-1,3) and (-1,6) .. (2321);
\draw[->,dgreencolor] (2132) -- (2123);
\draw[->,red] (2132) -- (1232);
\draw[->,dgreencolor] (2213) .. controls (1,3) and (1,6) .. (3212);
\draw[->,red] (2213) -- (2123);
\draw[->,dgreencolor] (1232) -- (1223);
\draw[->,red] (1232) .. controls (1,0) and (1,3) .. (2231);
\draw[->,red] (2123) -- (1223);
\draw[->,dgreencolor] (2123) .. controls (-1,0) and (-1,3) .. (3122);
\end{tikzpicture}
\]
\caption{The states and transitions for $\mcW_{\emptyset}$ for $n =3$ (left) and $\mcW_{\set{2}}$ for $n = 4$ (right).
All probabilities of the drawn transitions are $1/n$.}
\end{figure}

Building on work by Ferrari and Martin~\cite{FM06,FM07}, the paper~\cite{AAMP} introduced opposite operators $\Psi_i \colon \mcW_S \to \mcW_{S \setminus \{i\}}$ given by $\Psi_i(\epsilon_u) = \sum_{q} \epsilon_{q(u)}$, where the sum is taken over all $i$-queues $q$, and showed that $\Psi_i M_S = M_{S \setminus \{i\}} \Psi_i$.
Furthermore they proposed the \defn{commutativity conjecture}: that $\Psi_i \Psi_j = \Psi_j \Psi_i$.
By looking at the $(u,v)$ entry of both sides of this equation, the commutativity conjecture is asking whether the number of $(i,j)$-configurations $C$ such that $v = C(u)$ equals the number of $(j,i)$-configurations $C'$ such that $v = C'(u)$. 
Thus, our proof of Theorem~\ref{thm:permutation} shows that $\widetilde{\Psi}_i \widetilde{\Psi}_j = \widetilde{\Psi}_j \widetilde{\Psi}_i$ for the weighted operators $\widetilde{\Psi}_i$ given by
\[
\widetilde{\Psi}_i(\epsilon_u) = \sum_q \wt(q) \epsilon_{q(u)},
\]
where we also sum over all $i$-queues $q$.
Note that $\widetilde{\Psi}_i = \Psi_i$ when we specialize $x_1 = \cdots = x_n = 1$, giving the connection between our MLQs and the multi-species TASEP.
We note that the proof of interlacing given in~\cite{AAMP} is significantly different from our approach.

We have not managed to find a process similar to the TASEP whose transition matrix $\widetilde{M}_S$ would satisfy $\widetilde{M}_S \widetilde{\Psi}_i = \widetilde{\Psi}_i \widetilde{M}_{S \setminus \set{i}}$ for our $\widetilde{\Psi}_i$ operators.
Note however that queues give us \emph{a} random process with this property: for a word $u \in \mcW_S$, a move in the chain is given by
\begin{enumerate}
\item picking a random $i$-queue $q$
\item going to the state $\merge{t} q(u) \in \mcW_S$, where $t = \min\set{k \mid p_k(\mm_S) \geq i}$.
\end{enumerate}









%=====================================================================
\section{Proof of Theorem~\ref{thm:permutation}}
\label{sec:thm_proof}

In this section, we shall prove Theorem~\ref{thm:permutation} by relying on the
braid relation for dual configurations. We need some definitions first.

An \defn{$(r_1,r_2)$-configuration} shall mean a pair $C = (q_1, q_2)$, where $q_1$ is an $r_1$-queue and $q_2$ is an $r_2$-queue.
As usual, we consider $C$ as a function on words by $C(u) := q_2\bigr(q_1(u)\bigr)$, and we define the weight of $C$ by $\wt(C) := \wt(q_1) \wt(q_2)$.
We construct the \defn{dual}\footnote{This is a different duality than the contragredient duality of a queue given by Lemma~\ref{le:dual}.} $(r_2,r_1)$-configuration to $C$, which we denote by $C'$, as follows.

We begin by constructing a sequence of parentheses as follows: For each $j = 1, 2, \dotsc, n$ (in that order), we write
\begin{itemize}
\item an opening parenthesis `(' if $j \in q_1$ and $j \notin q_2$;
\item a closing parenthesis `)' if $j \notin q_1$ and $j \in q_2$;
\item a matched pair of parentheses `()' if $j \in q_1$ and $j \in q_2$;
\item nothing otherwise.
\end{itemize}
Next, we match as many parentheses as possible following the \defn{standard parenthesis-matching algorithm}:
every time you find an opening parenthesis to the left(cyclically) of a closing one, with only frozen letters between them, you match these two parentheses and declare them frozen.

Note that we do this cyclically, there will be $\abs{r_1 - r_2}$ unmatched `(' (resp.~`)') if and only if $r_1 > r_2$ (resp.~$r_1 < r_2$), and the unmatched parentheses will not depend on the order in which we perform the matching.
This can be easily seen by considering the parentheses as an infinite shifted-$n$-periodic Motzkin path, where a skipped letter corresponds to a flat step.
If $r_1 > r_2$, then the unmatched positions correspond to up steps in the Motzkin path such that the path never returns to the same height.
When $r_1 < r_2$, the unmatched positions correspond to the up steps where the Motzkin path first obtains a certain height.

If a site $j \in \ive{n}$ contributes a matched parenthesis, we say $j$ is \defn{balanced}; otherwise we say $j$ is \defn{unbalanced}.
We say $\mcI \subseteq \ive{n}$ is a \defn{balanced set} if all $i \in \mcI$ is balanced.
If $\mcI$ is connected, we call $\mcI$ a \defn{balanced interval}.

We construct $C' = (q'_1, q'_2)$ as follows.
For balanced $j$, we have $j \in q'_i$ if and only if $j \in q_i$ for $i=1,2$.
For unbalanced $j$, we have $j \in q'_i$ if and only if $j \in q_{3-i}$ for $i = 1,2$.
Note that $C$ and $C'$ have the same balanced intervals.
It is clear that $C'' = C$ and $\wt(C) = \wt(C')$.

The following facts are straightforward:
\begin{enumerate}
 \item For any balanced interval $\mcI$, we have $\lvert q_1 \cap \mcI \rvert = \lvert q_2 \cap \mcI \rvert$.
 \item The empty interval is balanced.
 \item The set $\ive{n}$ is a balanced set if and only if $r_1 = r_2$.
 \item If $A$ and $B$ are two balanced sets, then the set $A \cap B$
       is balanced.\footnote{To prove this, first check it when $A$ and $B$
       are balanced intervals.}
 \item If $A$ and $B$ are balanced intervals, and if $A \cup B$ is an
       interval, then $A \cup B$ is balanced.\footnote{This is obvious
       when one of $A$ and $B$ contains the other. Otherwise, argue
       that $A \cap B$, $A \setminus B$ and $B \setminus A$ are balanced.}
 \item Thus, the union of all balanced intervals (\textit{i.e.}, the set of all balanced
       $i \in \ive{n}$) is also the disjoint union of all maximal balanced intervals
       (where ``maximal'' means ``maximal under inclusion'').
 \item For $r_1 < r_2$ and $j \in \ive{n}$ unbalanced, we have $j \notin q_1$ and $j \in q_2$.
 \item For $r_1 > r_2$ and $j \in \ive{n}$ unbalanced, we have $j \in q_1$ and $j \notin q_2$.
 \item There are exactly $\abs{r_1 - r_2}$ unbalanced sites $i$.
\end{enumerate}

\begin{example}
Consider the configuration $C$ given in Figure~\ref{fig:balanced}.
The dual configuration $C'$ is given by sliding all of the circles not boxed from the upper level to the lower level.
In particular, we have $q_1' = q_1 \setminus \{1,5,6,8\}$ and $q_2' = q_2 \cup \{1,5,6,8\}$.
\end{example}

\begin{figure}[t]
\[
\begin{tikzpicture}[scale=0.75]
  \def\sc{0.85}   % Change this to adjust the x-scaling
  \def\ll{2}   % level 2
  \def\l{1}   % level 1
  \draw[fill=blue!30] (1.5*\sc,\l-.5) rectangle(4.5*\sc,\ll+.5);
  \draw[fill=blue!30] (6.5*\sc,\l-.5) rectangle(7.5*\sc,\ll+.5);
  \draw[fill=blue!30] (8.5*\sc,\l-.5) rectangle(20.5*\sc,\ll+.5);
  \foreach \i in {1,2,5,6,8,11,13,14,17,18,19} { \draw[fill=white] (\i*\sc,\ll) circle (0.3); }
  \foreach \i in {3,4,7,9,10,12,15,16,20} { \draw[fill=white] (\i*\sc-.3,\ll-.3) rectangle +(0.6,+0.6); }
  \foreach \i in {2,12,15,16,18,19,20} { \draw[fill=white] (\i*\sc,\l) circle (0.3); }
  \foreach \i in {1,3,4,5,6,7,8,9,10,11,13,14,17} { \draw[fill=white] (\i*\sc-.3,\l-.3) rectangle +(0.6,+0.6); }
\end{tikzpicture}
\]
\caption{We draw a $\bigcirc$ in position $i$ in row $j$ corresponding to $i \in q_j$ and a $\square$ if $i \notin q_j$.
The maximal balanced intervals are boxed.}
\label{fig:balanced}
\end{figure}


\begin{figure}[t]
\[
\begin{tikzpicture}[scale=0.45]
\draw[-,thin,red!50] (0,0) -- (24,0);
\draw[-,thin,red!50] (1,1) -- (24,1);
\draw[-,thin,red!50] (8,2) -- (24,2);
\draw[-,thin,red!50] (9,3) -- (24,3);
\draw[-,thin,red!50] (11,4) -- (24,4);
\draw[-,thin,red!50] (14,5) -- (16,5);
\draw[-,thin,red!50] (18,5) -- (22,5);
\draw[-,thick,dashed] (-1,1) -- (0,0);
\draw[-,dotted] (1,0) -- (1,1);
\draw[-,dotted] (3,0) -- (3,1);
\draw[-,dotted] (4,0) -- (4,1);
\draw[-,dotted] (5,0) -- (5,1);
\draw[-,dotted] (6,0) -- (6,2);
\draw[-,dotted] (7,0) -- (7,2);
\draw[-,dotted] (8,0) -- (8,2);
\draw[-,dotted] (9,0) -- (9,3);
\draw[-,dotted] (10,0) -- (10,4);
\draw[-,dotted] (11,0) -- (11,4);
\draw[-,dotted] (12,0) -- (12,5);
\draw[-,dotted] (13,0) -- (13,4);
\draw[-,dotted] (14,0) -- (14,5);
\draw[-,dotted] (15,0) -- (15,6);
\draw[-,dotted] (16,0) -- (16,5);
\draw[-,dotted] (17,0) -- (17,4);
\draw[-,dotted] (18,0) -- (18,5);
\draw[-,dotted] (20,0) -- (20,5);
\draw[-,dotted] (22,0) -- (22,5);
\draw[-,dotted] (23,0) -- (23,4);
\draw[-,thick] (0,0) -- (1,1) -- (2,2) -- (3,1) -- (4,1) -- (5,1) -- (6,2) -- (7,2) -- (8,2) -- (9,3) -- (10,4) -- (11,4) -- (12,5) -- (13,4) -- (14,5) -- (15,6) -- (16,5) -- (17,4) -- (18,5) -- (19,6) -- (20,5) -- (21,6) -- (22,5) -- (23,4);
\draw[-,thick,dashed] (23,4) -- (24,5);
\fill[blue] (0,0) circle (4pt);
\fill[blue] (5,1) circle (4pt);
\fill[blue] (8,2) circle (4pt);
\fill[blue] (9,3) circle (4pt);
\fill[blue] (23,4) circle (4pt);
\end{tikzpicture}
\]
\caption{The Motzkin path corresponding to the configuration in Figure~\ref{fig:balanced}.
The corresponding unbalanced up steps are marked by dots.}
\label{fig:balanced_motzkin}
\end{figure}

Recall the notations introduced just before Lemma~\ref{le:dual}.

\begin{remark}
\label{rmk:balanced-dual-let}
Let $C = (q_1, q_2)$ be an $(r_1, r_2)$-configuration.
Then, the interval $\mcI$ of $C$ is balanced if and only if the interval $\mcI^{\operatorname{refl}} = \set{ n + 1 - i \mid i \in \mcI }$ of the $(n-r_1, n-r_2)$-configuration $C^* = (q_1^*, q_2^*)$ is balanced.
In other words, the balanced intervals of $C$ are exactly the balanced intervals of $C^*$ but reflected through the middle of $\ive{n}$.
Thus, the dual configuration of $C^* = \tup{q_1^*, q_2^*}$ is obtained from the dual configuration $\tup{q_1', q_2'}$ of $C$ by
\begin{equation}
 (C^*)' = \bigl( (q_1')^*, (q_2')^* \bigr) .
 \label{eq.rmk:balanced-dual-let.dual}
\end{equation}
In addition, applying Lemma~\ref{le:dual} twice, we obtain
\[
C(u) = q_2\bigl( q_1(u) \bigr) = q_2\bigl( (q^*_1(u^*))^* \bigr) = \bigl( q_2^*\bigl( q_1^*(u^*) \bigr) \bigr)^* = \bigl( C^*(u^*) \bigr)^* .
\]
In particular, for $u \in \set{1,2}^n$, we have $C(u)_i = 5 - C^*(u^*)_{n+1-i}$, where we treat $u$ and $C^*(u^*)$ as a word with $2$ and $4$ classes, respectively.
\end{remark}

Fix $k \geq 1$.
In the following, we simplify our terminology and say that an MLQ
is a $k$-tuple of queues (without any restriction on their sizes).
We want to define an action of $\SymGp{k}$ on MLQs.
%by letting each simple transposition $s_i$ act as the map
For each $i \in \ive{k-1}$, we define a map $\fraks_i \colon \set{\text{MLQs}} \to \set{\text{MLQs}}$ by
\[
\fraks_i(q_1, q_2, \dotsc, q_k) = (q_1, \dotsc, q_{i-1}, q'_i, q'_{i+1}, q_{i+2}, \dotsc, q_k),
\]
where $\tup{q'_i, q'_{i+1}}$ is the dual configuration of $\tup{q_i, q_{i+1}}$.
From the definition of a dual configuration, it is clear that $\fraks_i \fraks_i \qq = \qq$.
It is also clear from the definition that $\fraks_i \fraks_j \qq = \fraks_j \fraks_i \qq$ if $\abs{i - j} > 1$.
Thus, the following proposition shows that $\fraks_i$ defines an action of $\SymGp{k}$ on the set of all MLQs.

\begin{prop} \label{prop:braid}
We have
\[
\fraks_i \fraks_{i+1} \fraks_i \qq
	   = \fraks_{i+1} \fraks_i \fraks_{i+1} \qq
\]
for any MLQ $\qq = \tup{q_1, \dotsc, q_k}$ and any $i \in \set{1, 2, \ldots, k-2}$.
\end{prop}

\begin{proof}
We shall deduce the claim from~\cite[Ch.~5, (5.6.3)]{Loth}.

Let $A$ be the $\tup{k+1}$-element set $\set{\circ, 1, 2, \ldots, k}$.
Let $A^*$ denote the set of all words on the alphabet $A$
(of any finite length).

We construct a $k \times n$-matrix $M_{\qq} \in A^{k \times n}$ from $\qq$ by setting the $\tup{i, j}$-th
entry to $i$ if $j \in q_i$ and $\circ$ otherwise.
We then construct a word $\word(\qq) \in A^*$ by reading $M_{\qq}$ from top-to-bottom, left-to-right (\textit{i.e.}, column by column).
For example, if $n = 5$, $k = 3$, then
\begin{align*}
\qq = \tup{\set{1, 3}, \set{2},
\set{2, 5}}
& \longleftrightarrow
 M_{\qq}
 =
 \begin{array}{ccccc}
  1 & \circ & 1 & \circ & \circ \\
  \circ & 2 & \circ  & \circ & \circ \\
  \circ & 3  & \circ & \circ & 3
 \end{array}
 \\ & \longrightarrow
 \word(\qq) = 1 \circ \circ \circ 2 3 1 \circ \circ \circ \circ \circ \circ \circ 3 .
\end{align*}
Clearly, an MLQ $\qq$ is uniquely determined by $\word(\qq)$ since $n$ is fixed.
In other words, the map $\word \colon \set{\text{MLQs}} \to A^*$
is injective.

Now, for each $i \in \set{1, 2, \ldots, k-1}$, we recall the operator
$\sigma_i \colon A^* \to A^*$ from~\cite[\S5.5]{Loth}.
This operator $\sigma_i$ acts on a word $p \in A^*$ % = \tup{p_1, p_2, \ldots, p_\ell}$
as follows:
\begin{enumerate}
 \item Treat all letters $i$ in $p$ as opening parentheses `(',
       all letters $i+1$ as closing parentheses `)',
       and consider all other letters to be frozen.
       Now, match as many parentheses as possible
       according to the standard parenthesis-matching algorithm.
       Notice that the result is always a word whose non-frozen
       part (\textit{i.e.}, the word obtained by removing
       all frozen letters) is
       $\underbrace{))\cdots)}_{a\text{ parentheses}}
       \underbrace{((\cdots(}_{b\text{ parentheses}}$
       for some integers $a, b \geq 0$.
       We call this the \defn{reduced signature} of $p$.
 \item Now, replace this non-frozen part by
       $\underbrace{))\cdots)}_{b\text{ parentheses}}
       \underbrace{((\cdots(}_{a\text{ parentheses}}$
       while keeping all frozen letters in their places.
       The resulting word is $\sigma_i p$.
\end{enumerate}
From~\cite[Eq.~(5.6.3)]{Loth}, these operators
$\sigma_i$ satisfy
\begin{equation}
 \sigma_i \sigma_{i+1} \sigma_i
 = \sigma_{i+1} \sigma_i \sigma_{i+1}
 \label{pf.prop:braid.loth-eq}
\end{equation}
for all $i \in \set{1, 2, \ldots, k-2}$.

Let $\zeta \colon \mcW_n \to \mcW_n$ be the cyclic shift map that sends each word $w_1 w_2 \cdots w_n$ to $w_2 w_3 \cdots w_n w_1$.
We also abuse the notation $\zeta$ for the map that sends each queue $q$ to the queue $\zeta q = \set{ i - 1 \mid i \in q }$ (recall that $0 = n$ as sites).
This map $\zeta$ shall act on MLQs entrywise (since an MLQ is a tuple of queues).
Clearly,
\begin{equation}
 \word(\zeta \qq) = \zeta^k \word(\qq)
 \label{pf.prop:braid.word-zeta}
\end{equation}
for any MLQ $\qq = (q_1, \ldots, q_k)$.

Now, we claim that
\begin{equation}
 \word(\fraks_i \qq) = \sigma_i\bigl( \word(\qq) \bigr)
 \qquad \text{ for each MLQ } \qq \text{ and each } i .
 \label{pf.prop:braid.inter}
\end{equation}
Note that it is sufficient to show that $\word(\fraks_1 \qq) = \sigma_1\bigl( \word(\qq) \bigr)$ for $\qq = (q_1, q_2)$
(because the definition of $\sigma_i$ only relies on the letters $i$ and $i+1$, while all other letters stay in their places and have no effect).

Thus, let $\qq = (q_1, q_2)$.
We want to show $\word(\fraks_1 \qq) = \sigma_1\bigl( \word(\qq) \bigr)$.
If $\abs{q_1} = \abs{q_2}$, then $\fraks_1 \qq = \qq$ by the definition of $\fraks_1$.
Moreover, we have $\sigma_1\bigl( \word(\qq) \bigr) = \word(\qq)$ in this case, since the word $\word(\qq)$ has as many letters $1$ as it has letters $2$, but the map $\sigma_1$ leaves such words unchanged.
Hence, the claim holds when $\abs{q_1} = \abs{q_2}$.
Thus, we assume that $\abs{q_1} \neq \abs{q_2}$.
Therefore, there exists at least one unbalanced site for the configuration $\qq = (q_1, q_2)$.

The operator $\fraks_1$ commutes with the cyclic shift map $\zeta$ on MLQs because $\zeta$ merely shifts the balanced intervals.
The operator $\sigma_1$ commutes with the cyclic shift map $\zeta$ on words in $A^*$ by~\cite[Prop.~5.6.1]{Loth}.
Hence, and because of~\eqref{pf.prop:braid.word-zeta}, we can apply $\zeta$ to $\qq$ any number of times without loss of generality.
Thus, we assume that the site $1$ is unbalanced for the configuration $\qq = (q_1, q_2)$, since at least one unbalanced site $j$ exists and we can cyclically shift until it is $1$.
Therefore, no balanced interval has the form $\inter[i,j]$ with $i > j$.


Note that the construction of balanced sites is exactly the sequence of parentheses constructed when applying $\sigma_1$ to $\word(\qq)$ (removing all $\circ$ letters).
Now, recall that $\fraks_1$ merely toggles the unbalanced sites between $q_1$ and $q_2$, whereas $\sigma_1$ switches the number of unmatched `)'s with the number of unmatched `('s (which, in the case of $\word(\qq)$, boils down to just turning each unmatched `)' into a `(' or vice versa, because one of the numbers is $0$).
Since the sites of the unmatched parentheses are precisely the unbalanced sites, this shows that the two maps agree -- that is, we have $\word(\fraks_1 \qq) = \sigma_1\bigl( \word(\qq) \bigr)$.
This proves~\eqref{pf.prop:braid.inter}.

The equality \eqref{pf.prop:braid.inter} can be rewritten as the
commutative diagram
\[
\xymatrix{
 \set{\text{MLQs}} \ar[r]^{\fraks_i} \ar[d]_{\word} & \set{\text{MLQs}} \ar[d]^{\word} \\
 A^* \ar[r]_{\sigma_i} & A^*
}
\]
for all $i \in \set{1, 2, \dotsc, k-1}$.
In view of the injectivity of the map $\word \colon \set{\text{MLQs}} \to A^*$,
this diagram allows us to translate~\eqref{pf.prop:braid.loth-eq} into
$\fraks_i \fraks_{i+1} \fraks_i = \fraks_{i+1} \fraks_i \fraks_{i+1}$.
\end{proof}

\begin{remark}
Our letters $1, \ldots, k$ correspond to the letters
$a_k, \ldots, a_1$ in~\cite{Loth},
since~\cite{Loth}'s definition of $\sigma_i$ involves $a_i$ rather
than $i+1$ as closing parenthesis and $a_{i+1}$ rather than $i$ as opening one.
Also,~\cite{Loth} does not include the letter $\circ$ in the alphabet,
but this makes no difference to the proof, since all letters $\circ$ are always frozen.
% Note that we have arbitrarily chosen to break our cycle at $n$,
% however by~\cite[Prop.~5.6.1]{Loth}, the result does not depend on this choice.
\end{remark}

\begin{remark}
The operator $\sigma_i$ is essentially a combination of co-plactic operators.
Moreover, it corresponds to the Weyl group action on a tensor product of crystals~\cite{BS17}.
Note that the bracketing rule given above is precisely the usual signature rule for computing tensor products.
This arises from considering the MLQ as a binary $m \times n$ matrix and the natural $(\mathfrak{sl}_m \oplus \mathfrak{sl}_n)$-action.
\end{remark}

Next, we define two queues corresponding to a word $w \in \mcW_n$ of type $\mm$.
Namely, for $k \in \set{p_i(\mm) \mid i \geq 0}$, let $[w]_k$ denote the set of the indices $i \in \ive{n}$
corresponding to the $k$ smallest letters $w_i$ of $w$.

The crucial tools in our proof of Theorem~\ref{thm:permutation} will be the following two facts.

\begin{lemma} \label{lem:SL.reconstruct}
Let $w, w' \in \mcW_n$ be two words of the same type $\mm$.
Assume that $[w]_k = [w']_k$ for each $k \in \set{p_i(\mm) \mid i \geq 0}$.
Then, $w = w'$.
\end{lemma}

\begin{proof}
Fix some $i \geq 1$.
The sites containing the letter $i$ in $w$ are the elements of $[w]_{p_i(\mm)} \setminus [w]_{p_{i-1}(\mm)}$
(since $w$ has type $\mm$).
Likewise,
the sites containing the letter $i$ in $w'$ are the elements of $[w']_{p_i(\mm)} \setminus [w']_{p_{i-1}(\mm)}$.
Since our assumption ($[w]_k = [w']_k$) yields $[w]_{p_i(\mm)} \setminus [w]_{p_{i-1}(\mm)}
= [w']_{p_i(\mm)} \setminus [w']_{p_{i-1}(\mm)}$, %\travis{FYI: still fighting us.},
we conclude that these are the same sites.
Since this holds for all letters $i$, we have $w = w'$.
\end{proof}

\begin{prop} \label{prop:SL.dual}
Let $u \in \mcW_n$ be a word of type $\mm$.
Let $k = p_{\alpha}(\mm)$ for some $\alpha$.
Let $q$ be a queue.
The dual configuration of $\tup{ [u]_k , q }$ has the form $\tup{q^{\dagger} , [q(u)]_k }$, where $q^{\dagger}$ is some queue.
\end{prop}

\begin{proof}
Choose a permutation $(i_1, i_2, \dotsc, i_n)$ of $\ive{n}$ such that $u_{i_1} \leq u_{i_2} \leq \cdots \leq u_{i_n}$.
Use this permutation to construct $q(u)$ as per the definition.
For each $p \in \ive{n}$, let $j_p$ denote the site that is set by $i_p$ when constructing $q(u)$.

Suppose $k < \abs{q}$.
It is sufficient to show that for every $p \in \ive{n}$, there exists a balanced interval $\mcI$ such that both $i_p, j_p \in \mcI$.
We proceed by induction on $p$, and we consider any matched $(_{i_a}$ with $)_{i_a}$ for $a < p$ to be frozen.
For the base case $p=1$, we start with the natural bracketing.
Note that we can rematch parentheses by
\begin{equation}
\label{eq:rematching}
(_a\ (_b\ )_b\ )_a \longrightarrow (_a\ (_b\ )_a\ )_b,
\end{equation}
where there can be any number of (frozen) parentheses in between.
Moreover, if we then freeze the $(_a\ )_a$ match, then we obtain the same matching as before rematching.
Thus, we apply the rematching~\eqref{eq:rematching} to move $)_{i_p}$ to the unmatched bracket from position $j_p$.
This proves Proposition~\ref{prop:SL.dual} in the case when $k < \abs{q}$.

Now suppose $k > \abs{q}$.
Let $\ell$ be the number of classes in $u$, and consider the contragredient duals $q^*$ and $u^*$ as in Lemma~\ref{le:dual}.
Thus, $n-k < n - \abs{q} = \abs{q^*}$.
Applying the $k < \abs{q}$ case (proven above)
to $n-k$, $u^*$ and $q^*$ instead of $k$, $u$ and $q$,
we see that
$\tup{ [u^*]_{n-k} , q^* }' = \tup{ q^\dagger , [q^*(u^*)]_{n-k} }$
for some queue $q^\dagger$.
Now,
\begin{align*}
 %\label{eq:dual_config_equalities}
 \bigl( (q'_1)^*, (q'_2)^* \bigr)
 &= \tup{ ([u]_k)^* , q^* }'
 = \tup{ [u^*]_{n-k} , q^* }' \\
 & = \tup{ q^\dagger , [q^*(u^*)]_{n-k} }
 = \tup{ q^\dagger , [(q(u))^*]_{n-k} } ,
\end{align*}
where
\begin{itemize}
 \item the first equality follows from~\eqref{eq.rmk:balanced-dual-let.dual};
 \item the second equality is because $([u]_k)^* = [u^*]_{n-k}$; and
 \item the fourth equality follows from Lemma~\ref{le:dual}.
\end{itemize}
Therefore, $(q'_2)^* = [(q(u))^*]_{n-k} = ([q(u)]_k)^*$, so that
$q'_2 = [q(u)]_k$.
Hence, Proposition~\ref{prop:SL.dual} is proven in the case when $k > \abs{q}$.
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:permutation}.]
Recall that any permutation in $\SymGp{\ell-1}$ is a product of simple transpositions $s_1, s_2, \ldots, s_{\ell-2}$.
Hence, in order to prove Theorem~\ref{thm:permutation}, it suffices to show that $\swt{u}_{\sigma} = \swt{u}_{\sigma s_i}$ for each $\sigma \in \SymGp{\ell-1}$ and $i \in \ive{\ell-2}$.
Then, Theorem~\ref{thm:permutation} follows by induction on length, \textit{i.e.} the minimal number of simple transpositions needed to write $\sigma$.

In order to prove $\swt{u}_{\sigma} = \swt{u}_{\sigma s_i}$, we need to show, for a $\sigma$-twisted MLQ $\qq$ of type $\mm$ satisfying $u = \qq (1 \dotsm 1)$, that $\fraks_i \qq$ is a $\sigma s_i$-twisted MLQ of type $\mm$ satisfying $u = (\fraks_i \qq) (1 \dotsm 1)$ (since this will show that $\fraks_i$ bijects the former MLQs to the latter).
The only nontrivial part is showing $u = (\fraks_i\qq) (1 \dotsm 1)$.
More generally, we will show that $(\fraks_i\qq)(w) = \qq(w)$ for any word $w \in \mcW_n$.
The proof of this claim reduces to showing that for any configuration $C = \tup{q_1, q_2}$ and any word $w \in \mcW_n$ the dual configuration $\fraks_1 C = C' = (q'_1, q'_2)$ of $C$ satisfies $C'(w) = C(w)$.

Each word $w$ can be obtained from a standard word by a sequence of
merges (each of which sends a word $u$ to $\vee^{(k)} u$ for some
$k \in \set{ p_j(\mm) \mid j \geq 1 }$, where $\mm$ is the type of
$u$). Lemma~\ref{lemma:queue_merge_commute} shows that these merges
commute with the action of a queue (and thus of an MLQ).
Hence, it is sufficient to consider standard words $w$.
Thus, assume that $w$ is standard of type $\mm$.
It is straightforward to see
(using Equation~\eqref{eq:queue_type_change} and $\abs{q'_2} = \abs{q_1}$ and $\abs{q'_1} = \abs{q_2}$)
that the words
$C(w) = q_2\bigl( q_1(w) \bigr)$
and
$C'(w) = q'_2\bigl( q_1'(w) \bigr)$
have the same type.
%indeed, the action of a queue $q$ on a word $w$ modifies its
%type in a predictable way (namely, the number $\abs{q}$ is
%inserted into the type of $w$ at the place where it would
%keep the type weakly increasing).
Let $\nn$ be this type.
We shall now show that
$[C'(w)]_k = [C(w)]_k$
for all $k \in \set{ p_i(\nn) \mid i \geq 0}$.
According to Lemma~\ref{lem:SL.reconstruct}, this will yield $C'(w) = C(w)$, and thus our proof will be complete.

Let $k \in \set{ p_i(\nn) \mid i \geq 0}$.
Thus, $k \in \set{0, 1, \ldots, n} = \set{ p_i(\mm) \mid i \geq 0 }$ (since $w$ is standard).
Hence, $[w]_k$ is well-defined.
Note that $q_i(w)$ and $q'_i(w)$ are also standard words.
Using Proposition~\ref{prop:SL.dual} to compute dual
configurations, we can see how the MLQ
$\qq = \tup{[w]_k, q_1, q_2}$ transforms under the action of
$\fraks_1 \fraks_2 \fraks_1$: Namely, we have
\begin{align*}
\tup{[w]_k, q_1, q_2} & \overset{\fraks_1}{\longmapsto} \tup{\ast, [q_1(w)]_k, q_2}
\\ & \overset{\fraks_2}{\longmapsto} \tup{\ast, \ast, \bigl[ q_2\bigl( q_1(w) \bigr) \bigr]_k}
\\ & \overset{\fraks_1}{\longmapsto} \tup{\ast, \ast, \bigl[ q_2\bigl( q_1(w) \bigr) \bigr]_k},
\end{align*}
where $\ast$ denotes some queue.
Likewise, the action of $\fraks_2 \fraks_1 \fraks_2$ is given by
\begin{align*}
\tup{[w]_k, q_1, q_2} & \overset{\fraks_2}{\longmapsto} \tup{[w]_k, q'_1, q'_2}
\\ & \overset{\fraks_1}{\longmapsto} \tup{\ast, [q'_1(w)]_k , q'_2}
\\ & \overset{\fraks_2}{\longmapsto} \tup{\ast, \ast, \bigl[ q'_2\bigl( q'_1(w) \bigr) \bigr]_k}.
\end{align*}
(See Figure~\ref{fig:crossing_diagrams} for the actions depicted using crossing diagrams.)
Yet, the two maps are equal by Proposition~\ref{prop:braid}.
Thus, the resulting MLQs must be identical:
\[
\tup{\ast, \ast, \bigl[ q'_2\bigl(q'_1(w) \bigr) \bigr]_k}
=
\tup{\ast, \ast, \bigl[ q_2\bigl(q_1(w) \bigr) \bigr]_k}.
\]
Hence, we have
\[
\bigl[ q'_2\bigl( q'_1(w) \bigr) \bigr]_k = \bigl[ q_2\bigl( q_1(w) \bigr) \bigr]_k.
\]
In other words, $[C'(w)]_k = [C(w)]_k$.
\end{proof}

\begin{figure}
\begin{gather*}
\begin{tikzpicture}[xscale=3.5]
\node (i1) at (0,0) {$[w]_k$};
\node (i2) at (0,-1) {$q_1$};
\node (i3) at (0,-2) {$q_2$};
\node (s11) at (1,0) {$\ast$};
\node (s12) at (1,-1) {$[q_1(w)]_k$};
\node (s13) at (1,-2) {$q_2$};
\node (s21) at (2,0) {$\ast$};
\node (s22) at (2,-1) {$\ast$};
\node (s23) at (2,-2) {$\bigl[ q_2\bigl( q_1(w) \bigr) \bigr]_k$};
\node (t1) at (3,0) {$\ast$};
\node (t2) at (3,-1) {$\ast$};
\node (t3) at (3,-2) {$\bigl[ q_2\bigl( q_1(w) \bigr) \bigr]_k$};
\path[-] (i2) edge (s11) (s11) edge (s21) (s21) edge (t2);
\path[-] (i3) edge (s13) (s13) edge (s22) (s22) edge (t1);
\path[-,red] (i1) edge (s12) (s12) edge (s23) (s23) edge (t3);
\end{tikzpicture}
\\
\begin{tikzpicture}[xscale=3.5]
\node (i1) at (0,0) {$[w]_k$};
\node (i2) at (0,-1) {$q_1$};
\node (i3) at (0,-2) {$q_2$};
\node (s11) at (1,0) {$[w]_k$};
\node (s12) at (1,-1) {$q'_1$};
\node (s13) at (1,-2) {$q'_2$};
\node (s21) at (2,0) {$\ast$};
\node (s22) at (2,-1) {$[q'_1(w)]_k$};
\node (s23) at (2,-2) {$q'_2$};
\node (t1) at (3,0) {$\ast$};
\node (t2) at (3,-1) {$\ast$};
\node (t3) at (3,-2) {$\bigl[ q'_2\bigl( q'_1(w) \bigr) \bigr]_k$};
\path[-] (i2) edge (s13) (s13) edge (s23) (s23) edge (t2);
\path[-] (i3) edge (s12) (s12) edge (s21) (s21) edge (t1);
\path[-,red] (i1) edge (s11) (s11) edge (s22) (s22) edge (t3);
\end{tikzpicture}
\end{gather*}
\caption{Crossing diagrams representing the action of $\fraks_1 \fraks_2 \fraks_1$ (top) and $\fraks_2 \fraks_1 \fraks_2$ (bottom).}
\label{fig:crossing_diagrams}
\end{figure}

\begin{remark}
Theorem~\ref{thm:permutation} for the special case of $x_1 = \cdots = x_n = 1$ was proven in~\cite{AAMP} using different techniques.
We also sketch an alternative direct approach in the FPSAC extended abstract version of this work~\cite{AGS18}.
\end{remark}






%=====================================================================
\section{Final remarks}
\label{sec:remarks}

We conclude by giving some additional examples, remarks, and comments about our results.
We begin with an example to illustrate the proof of Theorem~\ref{thm:merge} in more detail.

\begin{example}
In order to compute $\swt{135452}$, we need to examine MLQs of type $(1,1,1,1, 2, 0, 0, \ldots)$.
We take a particular MLQ $\qq$ and add the $5$-queue $\set{1,2,3,5,6}$ as follows:
\[
\qq = \;
\begin{tikzpicture}[baseline=66,scale=0.75,every node/.style={inner sep=2pt}]
\node at (0, 4){2};\node at (1, 4){2};\node at (2, 4){2};\node[circle, draw=black] at (3, 4){1};\node at (4, 4){2};\node at (5, 4){2};\node at (0, 3){3};\node at (1, 3){3};\node[circle, draw=black] at (2, 3){2};\node at (3, 3){3};\node at (4, 3){3};\node[circle, draw=black] at (5, 3){1};\node[circle, draw=black] at (0, 2){1};\node[circle, draw=black] at (1, 2){3};\node at (2, 2){4};\node at (3, 2){4};\node[circle, draw=black] at (4, 2){2};\node at (5, 2){4};\node[circle, draw=black] at (0, 1){1};\node[circle, draw=black] at (1, 1){3};\node at (2, 1){5};\node[circle, draw=black] at (3, 1){4};\node at (4, 1){5};\node[circle, draw=black] at (5, 1){2};
\end{tikzpicture}
\; \xrightarrow{\hspace{30pt}} \;
\begin{tikzpicture}[baseline=66,scale=0.75,every node/.style={inner sep=2pt}]
\node[circle, draw=black] at (0, 5){1};\node[circle, draw=black] at (1, 5){1};\node[circle, draw=black] at (2, 5){1};\node at (3, 5){2};\node[circle, draw=black] at (4, 5){1};\node[circle, draw=black] at (5, 5){1};\node at (0, 4){2};\node at (1, 4){2};\node at (2, 4){3};\node[circle, draw=black] at (3, 4){1};\node at (4, 4){2};\node at (5, 4){2};\node at (0, 3){3};\node at (1, 3){4};\node[circle, draw=black] at (2, 3){2};\node at (3, 3){3};\node at (4, 3){3};\node[circle, draw=black] at (5, 3){1};\node[circle, draw=black] at (0, 2){1};\node[circle, draw=black] at (1, 2){3};\node at (2, 2){4};\node at (3, 2){4};\node[circle, draw=black] at (4, 2){2};\node at (5, 2){5};\node[circle, draw=black] at (0, 1){1};\node[circle, draw=black] at (1, 1){3};\node at (2, 1){5};\node[circle, draw=black] at (3, 1){4};\node at (4, 1){6};\node[circle, draw=black] at (5, 1){2};
\end{tikzpicture}
\; = \widetilde{\qq}.
\]
Thus, we obtain a $(s_4 s_3 s_2 s_1)$-twisted MLQ $\widetilde{\qq}$ of type $(1, 1, 1, 1, 1, 1, 0, \ldots)$.
Furthermore, note that $135452 = \merge{5} 135462$.
Now, by Theorem~\ref{thm:permutation}, such MLQs $\widetilde{\qq}$ are in bijection with ordinary MLQs contributing to, in this case, $\swt{135462}$.
In more detail, let $R_i(\widetilde{\qq})$ be the MLQ formed by taking the configuration $C = (\widetilde{q}_i, \widetilde{q}_{i+1})$ and replacing it with the dual configuration.
By taking $R_4 R_3 R_2 R_1(\widetilde{\qq})$ to bring the top row to the bottom, we obtain the ordinary MLQ as follows:
\begin{align*}
\; \widetilde{\qq} & \xrightarrow[\hspace{15pt}]{R_1} \;
\begin{tikzpicture}[xscale=0.7,yscale=0.7,every node/.style={inner sep=0.8pt},baseline=55]
\node at (0, 5){2};\node at (1, 5){2};\node[circle, draw=black] at (2, 5){1};\node at (3, 5){2};\node at (4, 5){2};\node at (5, 5){2};\node[circle, draw=black] at (0, 4){2};\node[circle, draw=black] at (1, 4){2};\node at (2, 4){3};\node[circle, draw=black] at (3, 4){1};\node[circle, draw=black] at (4, 4){2};\node[circle, draw=black] at (5, 4){2};\node at (0, 3){3};\node at (1, 3){4};\node[circle, draw=black] at (2, 3){2};\node at (3, 3){3};\node at (4, 3){3};\node[circle, draw=black] at (5, 3){1};\node[circle, draw=black] at (0, 2){1};\node[circle, draw=black] at (1, 2){3};\node at (2, 2){4};\node at (3, 2){4};\node[circle, draw=black] at (4, 2){2};\node at (5, 2){5};\node[circle, draw=black] at (0, 1){1};\node[circle, draw=black] at (1, 1){3};\node at (2, 1){5};\node[circle, draw=black] at (3, 1){4};\node at (4, 1){6};\node[circle, draw=black] at (5, 1){2};
\end{tikzpicture}
\; \xrightarrow[\hspace{15pt}]{R_2} \;
\begin{tikzpicture}[xscale=0.7,yscale=0.7,every node/.style={inner sep=0.8pt},baseline=55]
\node at (0, 5){2};\node at (1, 5){2};\node[circle, draw=black] at (2, 5){1};\node at (3, 5){2};\node at (4, 5){2};\node at (5, 5){2};\node at (0, 4){3};\node[circle, draw=black] at (1, 4){2};\node at (2, 4){3};\node at (3, 4){3};\node at (4, 4){3};\node[circle, draw=black] at (5, 4){1};\node[circle, draw=black] at (0, 3){3};\node at (1, 3){4};\node[circle, draw=black] at (2, 3){2};\node[circle, draw=black] at (3, 3){3};\node[circle, draw=black] at (4, 3){3};\node[circle, draw=black] at (5, 3){1};\node[circle, draw=black] at (0, 2){1};\node[circle, draw=black] at (1, 2){3};\node at (2, 2){4};\node at (3, 2){4};\node[circle, draw=black] at (4, 2){2};\node at (5, 2){5};\node[circle, draw=black] at (0, 1){1};\node[circle, draw=black] at (1, 1){3};\node at (2, 1){5};\node[circle, draw=black] at (3, 1){4};\node at (4, 1){6};\node[circle, draw=black] at (5, 1){2};
\end{tikzpicture}
\allowdisplaybreaks
\\[1.3em] &
\; \xrightarrow[\hspace{15pt}]{R_3} \;
\begin{tikzpicture}[xscale=0.7,yscale=0.7,every node/.style={inner sep=0.8pt},baseline=55]
\node at (0, 5){2};\node at (1, 5){2};\node[circle, draw=black] at (2, 5){1};\node at (3, 5){2};\node at (4, 5){2};\node at (5, 5){2};\node at (0, 4){3};\node[circle, draw=black] at (1, 4){2};\node at (2, 4){3};\node at (3, 4){3};\node at (4, 4){3};\node[circle, draw=black] at (5, 4){1};\node[circle, draw=black] at (0, 3){3};\node at (1, 3){4};\node at (2, 3){4};\node at (3, 3){4};\node[circle, draw=black] at (4, 3){2};\node[circle, draw=black] at (5, 3){1};\node[circle, draw=black] at (0, 2){1};\node[circle, draw=black] at (1, 2){3};\node[circle, draw=black] at (2, 2){4};\node[circle, draw=black] at (3, 2){4};\node[circle, draw=black] at (4, 2){2};\node at (5, 2){5};\node[circle, draw=black] at (0, 1){1};\node[circle, draw=black] at (1, 1){3};\node at (2, 1){5};\node[circle, draw=black] at (3, 1){4};\node at (4, 1){6};\node[circle, draw=black] at (5, 1){2};\end{tikzpicture}
\; \xrightarrow[\hspace{15pt}]{R_4} \;
\begin{tikzpicture}[xscale=0.7,yscale=0.7,every node/.style={inner sep=0.8pt},baseline=55]
\node at (0, 5){2};\node at (1, 5){2};\node[circle, draw=black] at (2, 5){1};\node at (3, 5){2};\node at (4, 5){2};\node at (5, 5){2};\node at (0, 4){3};\node[circle, draw=black] at (1, 4){2};\node at (2, 4){3};\node at (3, 4){3};\node at (4, 4){3};\node[circle, draw=black] at (5, 4){1};\node[circle, draw=black] at (0, 3){3};\node at (1, 3){4};\node at (2, 3){4};\node at (3, 3){4};\node[circle, draw=black] at (4, 3){2};\node[circle, draw=black] at (5, 3){1};\node[circle, draw=black] at (0, 2){1};\node[circle, draw=black] at (1, 2){3};\node at (2, 2){5};\node[circle, draw=black] at (3, 2){4};\node[circle, draw=black] at (4, 2){2};\node at (5, 2){5};\node[circle, draw=black] at (0, 1){1};\node[circle, draw=black] at (1, 1){3};\node[circle, draw=black] at (2, 1){5};\node[circle, draw=black] at (3, 1){4};\node at (4, 1){6};\node[circle, draw=black] at (5, 1){2};
\end{tikzpicture}
\; = \widetilde{\qq}',
\end{align*}
which contributes to $\swt{135462}$.
\end{example}

There is the natural cyclic symmetry on our special weights.

\begin{prop}
  Let $C_n \subseteq \SymGp{n}$ denote the cyclic group of order $n$ generated by the $n$-cycle $(1 \; 2 \; \dotsm \; n)$ and $u \in \mcW_n$.
  We have $\swt{u}_{\tau}\sigma = \swt{u \sigma}_{\tau}$ for any $\sigma \in C_n$ and $\tau \in \SymGp{\ell-1}$, where $\SymGp{n}$ acts on $\mcW_n$ from the right by $(u_1 \dotsm u_n) \sigma = u_{\sigma(1)} \dotsm u_{\sigma(n)}$, that is to say permutations act on positions, and similarly on monomials in $\xx$.
\end{prop}

\begin{proof}
  For a queue $q$, define $\sigma q := \{ \sigma(i) \mid i \in q\}$.
  It is clear from the definition of a queue that $q(u \sigma) = \bigl( (\sigma q)(u) \bigr) \sigma$.
  Hence, for any $\tau$-twisted MLQ $\qq$ of type $\mm$, we have
  $\qq (u \sigma) = \bigl( (\sigma \qq)(u) \bigr) \sigma$,
  where the action of $C_n$ on MLQs is obtained by acting on each queue separately.
  Thus, in particular, for any $\tau$-twisted MLQ $\qq$ of type $\mm$, we have
  $\qq (1 \cdots 1) = \bigl( (\sigma \qq)(1 \cdots 1) \bigr) \sigma$.
  From here, the claim follows by an obvious bijection
  (given by the action of $\sigma$) between the sums defining
  $\swt{u}_{\tau} \sigma$ and $\swt{u \sigma}_{\tau}$.
\end{proof}

Let $B^{r,s}$, where $r \in [n-1]$ and $s \in \ZZ_{>0}$, be a \defn{Kirillov--Reshetikhin (KR) crystal} in type $A_{n-1}^{(1)}$~\cite{KKMMNN92}.
Recall from~\cite{NY97,Shimozono02} that the combinatorial $R$-matrix is the unique crystal isomorphism
\[
R \colon B^{r_1,s_1} \otimes B^{r_2,s_2} \to B^{r_2,s_2} \otimes B^{r_1,s_1}.
\]
There is a well-known (in slightly different terminology) bijection $\Xi_r$ relating $r$-queues with an element of the KR crystal $B^{r,1}$ in type $A_{n-1}^{(1)}$ by considering $q = \{b_1 < \cdots < b_r\}$  as a single-column Young tableau of height $r$.
In~\cite{KMO15}, this was extended to a bijection $\Xi$ between multiline queues of type $\mm$ with $\ell+1$ classes and $B^{p_1,1} \otimes B^{p_2,1} \otimes \dotsm \otimes B^{p_{\ell},1}$ by
\[
\Xi(\qq) = \Xi_{p_1}(q_1) \otimes \Xi_{p_2}(q_2) \otimes \dotsm \otimes \Xi_{p_{\ell}}(q_{\ell}).
\]
Thus, by comparing the description of the combinatorial $R$-matrix for $B^{r_1,1}$ and $B^{r_2,1}$ from~\cite{NY97}, we obtain that taking the dual configuration is equivalent to applying the combinatorial $R$-matrix under $\Xi$.

\begin{prop}
\label{prop:dual_is_R}
Let $C$ be an $(r_1, r_2)$-configuration. Then
\[
\Xi(C') = R\bigl( \Xi(C) \bigr),
\]
where $C'$ is the dual configuration of $C$.
\end{prop}

Note that Proposition~\ref{prop:dual_is_R} gives another proof of Proposition~\ref{prop:braid} since the combinatorial $R$-matrix is well-known to satisfy the Yang-Baxter equation.

\begin{example}
Suppose $n = 9$.
Consider the $(4,6)$-configuration and dual $(6,4)$-configuration
\[
C = (\set{1,4,5,6}, \set{2,3,4,6,7,8}),
\qquad\quad
C' = (\set{1,3,4,5,6,8}, \set{2,4,6,7}).
\]
We have
\[
\begin{tikzpicture}[xscale=6,yscale=4,>=stealth]
\node (C) at (0,0) { %{$(\set{1,4,5,6}, \set{2,3,4,6,7,8})$};
\begin{tikzpicture}[scale=0.7]
  \def\sc{0.85}   % Change this to adjust the x-scaling
  \def\ll{2}   % level 2
  \def\l{1}   % level 1
  \foreach \i in {1,4,5,6} { \draw[fill=white] (\i*\sc,\ll) circle (0.3); }
  \foreach \i in {2,3,7,8,9} { \draw[fill=white] (\i*\sc-.3,\ll-.3) rectangle +(0.6,+0.6); }
  \foreach \i in {2,3,4,6,7,8} { \draw[fill=white] (\i*\sc,\l) circle (0.3); }
  \foreach \i in {1,5,9} { \draw[fill=white] (\i*\sc-.3,\l-.3) rectangle +(0.6,+0.6); }
\end{tikzpicture}
};
\node (Cp) at (0,-1) { %{$(\set{1,3,4,5,6,8}, \set{2,4,6,7})$};
\begin{tikzpicture}[scale=0.7]
  \def\sc{0.85}   % Change this to adjust the x-scaling
  \def\ll{2}   % level 2
  \def\l{1}   % level 1
  \foreach \i in {1,3,4,5,6,8} { \draw[fill=white] (\i*\sc,\ll) circle (0.3); }
  \foreach \i in {2,7,9} { \draw[fill=white] (\i*\sc-.3,\ll-.3) rectangle +(0.6,+0.6); }
  \foreach \i in {2,4,6,7} { \draw[fill=white] (\i*\sc,\l) circle (0.3); }
  \foreach \i in {1,3,5,8,9} { \draw[fill=white] (\i*\sc-.3,\l-.3) rectangle +(0.6,+0.6); }
\end{tikzpicture}
};
\node (KR) at (1,0) {$\young(1,4,5,6) \otimes \young(2,3,4,6,7,8)$};
\node (KRp) at (1,-1) {$\young(1,3,4,5,6,8) \otimes \young(2,4,6,7)$};
\draw[<->] (C) -- (Cp) node[midway,anchor=east] {dual};
\draw[<->] (C) -- (KR) node[midway,anchor=south] {$\Xi$};
\draw[<->] (KR) -- (KRp) node[midway,anchor=west] {$R$};
\draw[<->] (Cp) -- (KRp) node[midway,anchor=north] {$\Xi$};
\end{tikzpicture}
\]
\end{example}

Since the combinatorial $R$-matrix satisfies the Yang--Baxter equation, we have an action of the symmetric group $\SymGp{\ell}$ acting on MLQs with $\ell + 1$ queues.
Given the description of the combinatorial $R$-matrix using the Robinson--Schensted--Knuth (RSK) bijection~\cite{Shimozono02}, this $\SymGp{\ell}$-action can be considered as corresponding to the one given by van Leeuwen~\cite[Lemma~2.3]{vanLeeuwen-dc}.\footnote{This could also be considered as an interpretation of the Littlewood--Richardson rule, along with the fact that $s_{\lambda} s_{\mu}$, where $s_{\lambda}$ and $s_{\mu}$ are Schur functions corresponding to rectangles, is multiplicity free~\cite{Stembridge01}, and using Howe duality~\cite[Ch.~9,App.~B]{BS17}.}
Furthermore, the $\SymGp{\ell}$-action on MLQs has been considered by Danilov and Koshevoy~\cite{DanilovKoshevoy} in a different context (see also~\cite[Ch.~4]{Gorodentsev2}).
Unlike the combinatorial $R$-matrix perspective, they do not have the natural interpretation of the weight since $\wt(\qq) = \wt\bigl( \Xi(\qq) \bigr)$, where the crystal weight is the usual tableaux weight.

Next, we describe how to interpret our action from looking at the corner transfer matrix described in~\cite{KMO15}, which can be given diagrammatically by
\[
\begin{tikzpicture}[>=latex,scale=0.5]
\draw[->] (0,1) node[anchor=east] {$\mathbf{b}_{\ell}$} -- (1,1) -- (1,8);
\foreach \x in {1,2} {
  \draw[->] (0,\x+1) node[anchor=east] {$\mathbf{b}_{\ell-\x}$} -- (\x+1,\x+1) -- (\x+1,8);
}
\foreach \x in {1,2,3} {
  \draw[->] (0,8-\x) node[anchor=east] {$\mathbf{b}_{\x}$} -- (8-\x,8-\x) -- (8-\x,8);
}
\node at (4,7.5) {$\cdots$};
\node at (0.5,4) {$\vdots$};
\end{tikzpicture}
\]
where every crossing is a combinatorial $R$-matrix and $\mathbf{b}_i \in B^{p_i,1}$.
Our action effectively does the following on the corner transfer matrix:
\[
\begin{tikzpicture}[>=latex,scale=0.5,baseline=50]
\draw[->] (0,1) node[anchor=east] {$\mathbf{b}_{\ell}$} -- (1,1) -- (1,7);
\draw[->] (0,6) node[anchor=east] {$\mathbf{b}_1$} -- (6,6) -- (6,7);
\draw[->] (-1,3) node[anchor=east] {$\mathbf{b}_i$} -- (0,4) -- (4,4) -- (4,7) -- (3,8);
\draw[->] (-1,4) node[anchor=east] {$\mathbf{b}_{i+1}$} -- (0,3) -- (3,3) -- (3,7) -- (4,8);
\node at (2,6.5) {$\cdots$};
\node at (0.5,2) {$\vdots$};
\node at (5,6.5) {$\cdots$};
\node at (0.5,5) {$\vdots$};
\end{tikzpicture}
\qquad = \qquad
\begin{tikzpicture}[>=latex,scale=0.5,baseline=50]
\draw[->] (0,1) node[anchor=east] {$\mathbf{b}_{\ell}$} -- (1,1) -- (1,7);
\draw[->] (0,6) node[anchor=east] {$\mathbf{b}_1$} -- (6,6) -- (6,7);
\draw[->] (0,4) node[anchor=east] {$\mathbf{b}_i$} -- (4,4) -- (4,7);
\draw[->] (0,3) node[anchor=east] {$\mathbf{b}_{i+1}$} -- (3,3) -- (3,7);
\node at (2,6.5) {$\cdots$};
\node at (0.5,2) {$\vdots$};
\node at (5,6.5) {$\cdots$};
\node at (0.5,5) {$\vdots$};
\end{tikzpicture}
\]
where the equality comes from applying the Yang--Baxter equation and $R^2 = \id$.

It could be interesting to see if our proof has any implications for the work of Danilov and Koshevoy~\cite{DanilovKoshevoy} or van Leeuwen~\cite{vanLeeuwen-dc}.








\bibliographystyle{alpha}
\bibliography{queue}{}
\end{document}
